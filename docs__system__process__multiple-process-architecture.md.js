(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[85],{twmC:function(e,n,r){"use strict";r.r(n);var t=r("q1tI"),l=r.n(t),a=(r("B2uJ"),r("+su7"),r("qOys")),o=r.n(a);r("5Yjd");n["default"]=function(){return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"markdown"},l.a.createElement("h1",{id:"\u591a\u8fdb\u7a0b\u67b6\u6784\u6a21\u578b"},l.a.createElement("a",{"aria-hidden":"true",href:"#\u591a\u8fdb\u7a0b\u67b6\u6784\u6a21\u578b"},l.a.createElement("span",{className:"icon icon-link"})),"\u591a\u8fdb\u7a0b\u67b6\u6784\u6a21\u578b"),l.a.createElement("p",null,"\u591a\u8fdb\u7a0b\u67b6\u6784\u89e3\u51b3\u4e86\u5355\u8fdb\u7a0b\u3001\u5355\u7ebf\u7a0b\u65e0\u6cd5\u5145\u5206\u5229\u7528\u7cfb\u7edf\u591a\u6838 CPU \u7684\u95ee\u9898\u3002"),l.a.createElement("p",null,"\u4e0b\u9762\u901a\u8fc7\u4e00\u4e2a\u4f8b\u5b50\u5b9e\u73b0\u591a\u8fdb\u7a0b\u67b6\u6784\u6279\u91cf\u542f\u52a8 Node.js \u8fdb\u7a0b\u670d\u52a1\u3002"),l.a.createElement("h2",{id:"\u4e3b\u8fdb\u7a0b"},l.a.createElement("a",{"aria-hidden":"true",href:"#\u4e3b\u8fdb\u7a0b"},l.a.createElement("span",{className:"icon icon-link"})),"\u4e3b\u8fdb\u7a0b"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u521b\u5efa Server \u5e76\u76d1\u542c\u6307\u5b9a\u7aef\u53e3\uff08\u4f8b\u5982\uff1a3000\uff09"),l.a.createElement("li",null,"\u6839\u636e\u7cfb\u7edf ",l.a.createElement("code",null,"cpus")," \u5f00\u542f\u591a\u4e2a\u5b50\u8fdb\u7a0b"),l.a.createElement("li",null,"\u901a\u8fc7\u5b50\u8fdb\u7a0b\u5bf9\u8c61\u7684 ",l.a.createElement("code",null,"send")," \u65b9\u6cd5\u53d1\u6d88\u606f\u5230\u5b50\u8fdb\u7a0b\u8fdb\u884c\u901a\u4fe1"),l.a.createElement("li",null,"\u5728\u4e3b\u8fdb\u7a0b\u4e2d\u76d1\u542c\u5b50\u8fdb\u7a0b\u7684\u53d8\u5316\uff0c\u5982\u679c\u662f\u81ea\u6740\u4fe1\u53f7\u91cd\u65b0\u542f\u52a8\u4e00\u4e2a\u5de5\u4f5c\u8fdb\u7a0b"),l.a.createElement("li",null,"\u4e3b\u8fdb\u7a0b\u5728\u76d1\u542c\u5230\u9000\u51fa\u6d88\u606f\u7684\u65f6\u5019\uff0c\u5148\u9000\u51fa\u5b50\u8fdb\u7a0b\u518d\u9000\u51fa\u4e3b\u8fdb\u7a0b")),l.a.createElement(o.a,{code:"// master.js\nconst fork = require('child_process').fork;\nconst cpus = require('os').cpus();\n\nconst server = require('net').createServer();\nserver.listen(3000);\nprocess.title = 'node-master';\n\nconst workers = {};\nconst createWorker = () => {\n  const worker = fork('worker.js');\n  worker.on('message', function(message) {\n    if (message.act === 'suicide') {\n      createWorker();\n    }\n  });\n  worker.on('exit', function(code, signal) {\n    console.log('worker process exited, code: %s signal: %s', code, signal);\n    delete workers[worker.pid];\n  });\n  worker.on('server', server);\n  workers[worker.pid] = worker;\n  console.log('worker process created, pid: %s ppid: %s', worker.pid, process.pid);\n};\n\nfor (let i = 0; i < cpus.length; i++) {\n  createWorker();\n}\n\n// kill(2) Ctrl+C\nprocess.once('SIGINT', close.bind(this, 'SIGINT'));\n// kill(3) Ctrl+\\\nprocess.once('SIGQUIT', close.bind(this, 'SIGQUIT'));\n// kill(15) default\nprocess.once('SIGTERM', close.bind(this, 'SIGTERM'));\nprocess.once('exit', close.bind(this));\n\nfunction close(code) {\n  console.log('\u8fdb\u7a0b\u9000\u51fa\uff01', code);\n\n  if (code !== 0) {\n    for (let pid in workers) {\n      console.log('master process exited, kill worker pid:', pid);\n      workers[pid].kill('SIGINT');\n    }\n  }\n\n  process.exit(0);\n}\n",lang:"js"}),l.a.createElement("h2",{id:"\u5b50\u8fdb\u7a0b"},l.a.createElement("a",{"aria-hidden":"true",href:"#\u5b50\u8fdb\u7a0b"},l.a.createElement("span",{className:"icon icon-link"})),"\u5b50\u8fdb\u7a0b"),l.a.createElement("ul",null,l.a.createElement("li",null,"\u521b\u5efa Server \u5bf9\u8c61\uff0c\u4e0d\u7528\u76d1\u542c\u7aef\u53e3"),l.a.createElement("li",null,"\u901a\u8fc7 ",l.a.createElement("code",null,"message")," \u4e8b\u4ef6\u63a5\u6536\u4e3b\u8fdb\u7a0b ",l.a.createElement("code",null,"send")," \u65b9\u6cd5\u53d1\u9001\u7684\u6d88\u606f"),l.a.createElement("li",null,"\u76d1\u542c ",l.a.createElement("code",null,"uncaughtException")," \u4e8b\u4ef6\uff0c\u6355\u83b7\u672a\u5904\u7406\u7684\u5f02\u5e38\uff0c\u53d1\u9001\u81ea\u6740\u4fe1\u606f\u7531\u4e3b\u8fdb\u7a0b\u91cd\u5efa\u8fdb\u7a0b\uff0c\u5b50\u8fdb\u7a0b\u5728\u94fe\u63a5\u5173\u95ed\u4e4b\u540e\u9000\u51fa")),l.a.createElement(o.a,{code:"// worker.js\nconst http = require('http');\nconst server = http.createServer((req, res) => {\n  res.writeHead(200, {\n    'Content-Type': 'text/plain',\n  });\n  res.end('I am worker, pid:' + process.pid + ', ppid:' + process.ppid);\n\n  throw new Error('worker process exception!');\n  // \u6d4b\u8bd5\u5f02\u5e38\u8fdb\u7a0b\u9000\u51fa\u3001\u91cd\u5efa\n});\n\nlet worker;\nprocess.title = 'node-worker';\nprocess.on('message', function(message, sendHandle) {\n  if (message === 'server') {\n    worker = sendHandle;\n    worker.on('connection', function(socket) {\n      server.emit('connection', socket);\n    });\n  }\n});\n\nprocess.on('uncaughtException', function(err) {\n  console.log(err);\n  process.send({ act: 'suicide' });\n  worker.close(function() {\n    process.exit(1);\n  });\n});\n",lang:"js"}),l.a.createElement("p",null,"\u4ee5\u4e0a\u793a\u4f8b\u7b80\u5355\u5730\u4ecb\u7ecd\u4e86\u591a\u8fdb\u7a0b\u521b\u5efa\u3001\u5f02\u5e38\u76d1\u542c\u3001\u91cd\u542f\u7b49\uff0c\u4f46\u662f\u4f5c\u4e3a\u4f01\u4e1a\u7ea7\u5e94\u7528\u7a0b\u5e8f\u6211\u4eec\u8fd8\u9700\u8981\u8003\u8651\u7684\u66f4\u5b8c\u5584\uff0c\u4f8b\u5982\uff1a\u8fdb\u7a0b\u7684\u91cd\u542f\u6b21\u6570\u9650\u5236\u3001\u4e0e\u5b88\u62a4\u8fdb\u7a0b\u7ed3\u5408\u3001\u591a\u8fdb\u7a0b\u6a21\u5f0f\u4e0b\u5b9a\u65f6\u4efb\u52a1\u5904\u7406\u7b49\u3002\u63a8\u8350\u770b\u963f\u91cc ",l.a.createElement("a",{href:"https://eggjs.org/zh-cn/core/cluster-and-ipc.html",target:"_blank",rel:"noopener noreferrer"},"Egg.js \u591a\u8fdb\u7a0b\u6a21\u5f0f",l.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15",className:"__dumi-default-external-link-icon"},l.a.createElement("path",{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}),l.a.createElement("polygon",{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"})))),l.a.createElement("h2",{id:"\u72b6\u6001\u5171\u4eab"},l.a.createElement("a",{"aria-hidden":"true",href:"#\u72b6\u6001\u5171\u4eab"},l.a.createElement("span",{className:"icon icon-link"})),"\u72b6\u6001\u5171\u4eab"),l.a.createElement("blockquote",null,l.a.createElement("p",null,"\u591a\u8fdb\u7a0b\u6216\u591a\u4e2a Web \u670d\u52a1\u4e4b\u95f4\u7684\u72b6\u6001\u5171\u4eab\u95ee\u9898\uff1f")),l.a.createElement("p",null,"\u591a\u8fdb\u7a0b\u6a21\u5f0f\u4e0b\u5404\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u662f\u76f8\u4e92\u72ec\u7acb\u7684\uff0c\u4f8b\u5982\u7528\u6237\u767b\u5f55\u4e4b\u540e session \u7684\u4fdd\u5b58\uff0c\u5982\u679c\u4fdd\u5b58\u5728\u670d\u52a1\u8fdb\u7a0b\u91cc\uff0c\u90a3\u4e48\u5982\u679c\u6211\u6709 4 \u4e2a\u5de5\u4f5c\u8fdb\u7a0b\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u8981\u4fdd\u5b58\u4e00\u4efd\u662f\u6ca1\u5fc5\u8981\u7684\uff0c\u5047\u8bbe\u670d\u52a1\u91cd\u542f\u4e86\u6570\u636e\u4e5f\u4f1a\u4e22\u5931\u3002\u591a\u4e2a Web \u670d\u52a1\u4e5f\u662f\u4e00\u6837\u7684\uff0c\u8fd8\u4f1a\u51fa\u73b0\u6211\u5728 A \u673a\u5668\u4e0a\u521b\u5efa\u4e86 Session\uff0c\u5f53\u8d1f\u8f7d\u5747\u8861\u5206\u53d1\u5230 B \u673a\u5668\u4e0a\u4e4b\u540e\u8fd8\u9700\u8981\u518d\u521b\u5efa\u4e00\u4efd\u3002\u4e00\u822c\u7684\u505a\u6cd5\u662f\u901a\u8fc7 Redis \u6216\u8005\u6570\u636e\u5e93\u6765\u505a\u6570\u636e\u5171\u4eab\u3002"),l.a.createElement("hr",null),l.a.createElement("p",null,l.a.createElement("strong",null,"\u53c2\u8003\u8d44\u6599\uff1a")),l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("a",{href:"https://www.cnblogs.com/tugenhua0707/p/11141076.html",target:"_blank",rel:"noopener noreferrer"},"\ud83d\udcdd \u6d45\u8c08 Node.js \u591a\u8fdb\u7a0b\u670d\u52a1\u67b6\u6784\u57fa\u672c\u539f\u7406",l.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15",className:"__dumi-default-external-link-icon"},l.a.createElement("path",{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}),l.a.createElement("polygon",{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"})))),l.a.createElement("li",null,l.a.createElement("a",{href:"https://eggjs.org/zh-cn/core/cluster-and-ipc.html",target:"_blank",rel:"noopener noreferrer"},"\ud83d\udcd6 Egg.js \u591a\u8fdb\u7a0b\u6a21\u578b\u548c\u8fdb\u7a0b\u95f4\u901a\u8baf",l.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-hidden":!0,x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15",className:"__dumi-default-external-link-icon"},l.a.createElement("path",{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}),l.a.createElement("polygon",{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"})))))))}}}]);