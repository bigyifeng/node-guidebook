(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[53],{"/kum":function(e,n,a){"use strict";a.r(n);var t=a("q1tI"),l=a.n(t),c=(a("B2uJ"),a("+su7"),a("qOys")),r=a.n(c);a("5Yjd");n["default"]=function(){return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"markdown"},l.a.createElement("h1",{id:"\u5b50\u6587\u6863-subdocuments"},l.a.createElement("a",{"aria-hidden":"true",href:"#\u5b50\u6587\u6863-subdocuments"},l.a.createElement("span",{className:"icon icon-link"})),"\u5b50\u6587\u6863 Subdocuments"),l.a.createElement("p",null,"\u5b50\u6587\u6863\u662f\u6307\u5d4c\u5957\u5728\u53e6\u4e00\u4e2a\u6587\u6863\u4e2d\u7684\u6587\u6863\u3002\u5728 Mongoose \u4e2d\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u53ef\u4ee5\u5728\u91cc\u5d4c\u5957\u53e6\u4e00\u4e2a Schema\u3002"),l.a.createElement("p",null,"Mongoose \u5b50\u6587\u6863\u6709\u4e24\u79cd\u4e0d\u540c\u7684\u6982\u5ff5\uff1a",l.a.createElement("strong",null,"\u5b50\u6587\u6863\u6570\u7ec4"),"\u548c",l.a.createElement("strong",null,"\u5355\u4e2a\u5d4c\u5957\u5b50\u6587\u6863"),"\u3002"),l.a.createElement(r.a,{code:"const childSchema = new Schema({ name: 'string' });\n\nconst parentSchema = new Schema({\n  // Array of subdocuments\n  children: [childSchema],\n  // Single nested subdocuments.\n  // Caveat: single nested subdocs only work\n  // in mongoose >= 4.2.0\n  child: childSchema,\n});\n",lang:"js"}),l.a.createElement("p",null,"\u5b50\u6587\u6863\u4e0e\u666e\u901a document \u7c7b\u4f3c\u3002\u5d4c\u5957 Schema \u53ef\u4ee5\u6709\u81ea\u5df1\u7684\u4e2d\u95f4\u4ef6\u3001\u81ea\u5b9a\u4e49\u68c0\u9a8c\u903b\u8f91\u3001\u865a\u62df\u503c\u4ee5\u53ca\u5176\u5b83\u9876\u5c42 Schemas \u53ef\u7528\u7684\u7279\u6027\u3002\u4e24\u8005\u4e3b\u8981\u7684\u4e0d\u540c\u70b9\u662f\u5b50\u6587\u6863\u4e0d\u80fd\u5355\u72ec\u4fdd\u5b58\uff0c\u4ed6\u4eec\u4f1a\u5728\u4ed6\u4eec\u7684\u9876\u7ea7\u6587\u6863\u4fdd\u5b58\u65f6\u4fdd\u5b58\u3002"),l.a.createElement(r.a,{code:"const Parent = mongoose.model('Parent', parentSchema);\n\nconst parent = new Parent({ children: [{ name: 'Matt' }, { name: 'Sarah' }] });\n\nparent.children[0].name = 'Matthew';\n\n// `parent.children[0].save()` \u65e0\u64cd\u4f5c\uff0c\u867d\u7136\u4ed6\u4eec\u89e6\u53d1\u4e86\u4e2d\u95f4\u4ef6\n// \u4f46\u662f\u6ca1\u6709\u4fdd\u5b58\u6587\u6863\uff0c\u4f60\u9700\u8981 save \u4ed6\u7684\u7236\u6587\u6863\nparent.save(callback);\n",lang:"js"}),l.a.createElement("p",null,"\u5b50\u6587\u6863\u4e0e\u666e\u901a document \u4e00\u6837\u6709 ",l.a.createElement("code",null,"save")," \u548c ",l.a.createElement("code",null,"validate")," \u4e2d\u95f4\u4ef6\u3002\u8c03\u7528\u7236\u6587\u6863\u7684 ",l.a.createElement("code",null,"save()")," \u4f1a\u89e6\u53d1\u5176\u6240\u6709\u5b50\u6587\u6863 ",l.a.createElement("code",null,"save()")," \u4e2d\u95f4\u4ef6\uff0c",l.a.createElement("code",null,"validate()")," \u4e2d\u95f4\u4ef6\u540c\u7406\u3002"),l.a.createElement(r.a,{code:"childSchema.pre('save', function(next) {\n  if ('invalid' === this.name) {\n    return next(new Error('#sadpanda'));\n  }\n  next();\n});\n\nconst parent = new Parent({ children: [{ name: 'invalid' }] });\n\nparent.save(function(err) {\n  console.log(err.message); // #sadpanda\n});\n",lang:"js"}),l.a.createElement("p",null,"\u5b50\u6587\u6863\u7684 ",l.a.createElement("code",null,"pre('save')")," \u548c ",l.a.createElement("code",null,"pre('validate')")," \u4e2d\u95f4\u4ef6\u6267\u884c\u4e8e\u9876\u5c42 document \u7684 ",l.a.createElement("code",null,"pre('save')")," \u4e4b\u524d\uff0c\u9876\u5c42 document \u7684 ",l.a.createElement("code",null,"pre('validate')")," \u4e4b\u540e\u3002\u56e0\u4e3a ",l.a.createElement("code",null,"save()")," \u524d\u7684\u9a8c\u8bc1\u5c31\u662f\u4e00\u4e2a\u5185\u7f6e\u4e2d\u95f4\u4ef6\u3002"),l.a.createElement(r.a,{code:"// \u4ee5\u4e0b\u4ee3\u7801\u987a\u5e8f\u6253\u5370\u51fa 1-4\nconst childSchema = new mongoose.Schema({ name: 'string' });\n\nchildSchema.pre('validate', function(next) {\n  console.log('2');\n  next();\n});\n\nchildSchema.pre('save', function(next) {\n  console.log('3');\n  next();\n});\n\nconst parentSchema = new mongoose.Schema({\n  child: childSchema,\n});\n\nparentSchema.pre('validate', function(next) {\n  console.log('1');\n  next();\n});\n\nparentSchema.pre('save', function(ert) {\n  console.log('4');\n  next();\n});\n",lang:"js"}),l.a.createElement("h2",{id:"\u67e5\u627e\u5b50\u6587\u6863"},l.a.createElement("a",{"aria-hidden":"true",href:"#\u67e5\u627e\u5b50\u6587\u6863"},l.a.createElement("span",{className:"icon icon-link"})),"\u67e5\u627e\u5b50\u6587\u6863"),l.a.createElement("p",null,"\u6bcf\u4e2a\u5b50\u6587\u6863\u90fd\u6709\u4e00\u4e2a\u9ed8\u8ba4\u7684 ",l.a.createElement("code",null,"_id"),"\u3002"),l.a.createElement("p",null,"Mongoose document \u6570\u7ec4\u6709\u4e00\u4e2a\u7279\u522b\u7684 ",l.a.createElement("code",null,"id")," \u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u8981\u4f20\u5165 ",l.a.createElement("code",null,"_id")," \u5c31\u80fd\u8fd4\u56de\u6587\u6863\u6570\u7ec4\u4e2d\u7279\u5b9a\u6587\u6863\u3002"),l.a.createElement(r.a,{code:"const doc = parent.children.id(_id);\n",lang:"js"}),l.a.createElement("h2",{id:"\u6dfb\u52a0\u5b50\u6587\u6863\u5230\u6570\u7ec4"},l.a.createElement("a",{"aria-hidden":"true",href:"#\u6dfb\u52a0\u5b50\u6587\u6863\u5230\u6570\u7ec4"},l.a.createElement("span",{className:"icon icon-link"})),"\u6dfb\u52a0\u5b50\u6587\u6863\u5230\u6570\u7ec4"),l.a.createElement("p",null,"Mongoose \u6570\u7ec4\u65b9\u6cd5\u6709 ",l.a.createElement("code",null,"push"),"\u3001",l.a.createElement("code",null,"unshift"),"\u3001",l.a.createElement("code",null,"addToSet")," \u53ca\u5176\u5b83\u3002"),l.a.createElement(r.a,{code:"const Parent = mongoose.model('Parent');\nconst parent = new Parent();\n\n// Create a comment\nparent.children.push({ name: 'Lies1' });\nconst subdoc = parent.children[0];\n\nconsole.log(subdoc);\n// { _id: 'xxx', name: 'Lies1' }\n\nsubdoc.isNew;\n// true\n\nparent.save(function(err) {\n  if (err) return handleError(err);\n  console.log('Success!');\n});\n",lang:"js"}),l.a.createElement("h2",{id:"\u5220\u9664\u5b50\u6587\u6863"},l.a.createElement("a",{"aria-hidden":"true",href:"#\u5220\u9664\u5b50\u6587\u6863"},l.a.createElement("span",{className:"icon icon-link"})),"\u5220\u9664\u5b50\u6587\u6863"),l.a.createElement("p",null,"\u6bcf\u4e2a\u5b50\u6587\u6863\u90fd\u6709 ",l.a.createElement("code",null,"remove")," \u65b9\u6cd5\u3002\u53e6\u5916\uff0c\u5bf9\u4e8e\u5b50\u6587\u6863\u6570\u7ec4\uff0c\u6709\u4e00\u4e2a\u7b49\u6548\u65b9\u6cd5 ",l.a.createElement("code",null,".pull()"),"\u3002\u5bf9\u4e8e\u5355\u4e2a\u5d4c\u5957\u5b50\u6587\u6863\uff0c",l.a.createElement("code",null,"remove()")," \u4e0e\u628a\u8fd9\u4e2a\u6587\u6863\u7684\u503c\u8bbe\u4e3a ",l.a.createElement("code",null,"null")," \u7b49\u6548\u3002"),l.a.createElement(r.a,{code:"// \u7b49\u6548\u4e8e `parent.children.pull(_id)`\nparent.children.id(_id).remove();\n\n// \u7b49\u6548\u4e8e `parent.child = null`\nparent.child.remove();\npaernt.save(function(err) {\n  if (err) return handleError(err);\n  console.log('The subdocs were removed');\n});\n",lang:"js"})))}}}]);