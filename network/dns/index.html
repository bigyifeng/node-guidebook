<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/node-guidebook/umi.css" />
    <script>
      window.routerBase = "/node-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>DNS 域名服务器</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//">Node Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/node-guidebook//overview">概览</a><a href="/node-guidebook//engine">引擎</a><a href="/node-guidebook//system">系统</a><a aria-current="page" class="active" href="/node-guidebook//network">网络</a><a href="/node-guidebook//server-application">服务端应用</a><a href="/node-guidebook//util-application">工具应用</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//"></a><h1>Node Guidebook</h1><p>Node 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/node-guidebook//overview">概览</a></li><li><a href="/node-guidebook//engine">引擎</a></li><li><a href="/node-guidebook//system">系统</a></li><li><a aria-current="page" class="active" href="/node-guidebook//network">网络</a></li><li><a href="/node-guidebook//server-application">服务端应用</a></li><li><a href="/node-guidebook//util-application">工具应用</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/node-guidebook//network/socket">Socket 套接字</a></li><li><a aria-current="page" class="active" href="/node-guidebook//network/dns">DNS 域名服务器</a></li><li><a href="/node-guidebook//network/net">Net 网络</a></li><li><a href="/node-guidebook//network/dgram">Dgram 数据报</a></li><li><a aria-current="page" class="active" href="/node-guidebook//network">HTTP</a><ul><li><a href="/node-guidebook//network/http"><span>HTTP</span></a></li><li><a href="/node-guidebook//network/http-server"><span>HTTP Server</span></a></li><li><a href="/node-guidebook//network/http-client-request"><span>HTTP ClientRequest</span></a></li><li><a href="/node-guidebook//network/http-incoming-message"><span>HTTP IncomingMessage</span></a></li><li><a href="/node-guidebook//network/http-server-response"><span>HTTP ServerResponse</span></a></li><li><a href="/node-guidebook//network/https"><span>HTTPS</span></a></li><li><a href="/node-guidebook//network/http2"><span>HTTP2</span></a></li></ul></li><li><a href="/node-guidebook//network/url">URL</a></li><li><a href="/node-guidebook//network/querystring">QueryString 查询字符串</a></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="基本概况" data-depth="2" class=""><a href="/node-guidebook//network/dns#基本概况"><span>基本概况</span></a></li><li title="模块方法" data-depth="2" class=""><a href="/node-guidebook//network/dns#模块方法"><span>模块方法</span></a></li><li title="记录类型" data-depth="2" class=""><a href="/node-guidebook//network/dns#记录类型"><span>记录类型</span></a></li><li title="CNAME" data-depth="3" class=""><a href="/node-guidebook//network/dns#cname"><span>CNAME</span></a></li><li title="PTR" data-depth="3" class=""><a href="/node-guidebook//network/dns#ptr"><span>PTR</span></a></li><li title="错误码" data-depth="2" class=""><a href="/node-guidebook//network/dns#错误码"><span>错误码</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="dns"><a aria-hidden="true" href="#dns"><span class="icon icon-link"></span></a>DNS</h1><p><a href="https://tsejx.github.io/JavaScript-Guidebook/computer-networks/dns.html" target="_blank" rel="noopener noreferrer">关于 DNS 域名解析系统<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>dns 模块用于解析域名。</p><h2 id="基本概况"><a aria-hidden="true" href="#基本概况"><span class="icon icon-link"></span></a>基本概况</h2><p>dns 模块包含两大类函数：</p><ul><li>第一类函数，使用底层操作系统工具进行域名解析，且无需进行网络通信。 这类函数只有一个：<code>dns.lookup()</code></li><li>第二类函数，连接到真实的 DNS 服务器进行域名解析，且始终使用网络进行 DNS 查询。 这类函数包含了 dns 模块中除 <code>dns.lookup()</code> 以外的所有函数。 这些函数使用与 <code>dns.lookup()</code> 不同的配置文件（例如 <code>/etc/hosts</code>）</li></ul><table><thead><tr><th>方法</th><th>功能</th><th>同步</th><th>网络请求</th><th>速度</th></tr></thead><tbody><tr><td>lookup</td><td>通过系统自带的 DNS 缓存（如 <code>/etc/hosts</code>）</td><td>同步</td><td>无</td><td>快</td></tr><tr><td>resolve</td><td>通过系统配置的 DNS 服务器指定的记录（rrtype 指定）</td><td>异步</td><td>有</td><td>慢</td></tr></tbody></table><p><strong>dns 模块中 <code>.loopup</code> 与 <code>.resolve</code> 的区别：</strong></p><p>当你要解析一个域名的 IP 时，通过 <code>.lookup</code> 查询直接调用 <code>getaddrinfo</code> 来拿去地址，速度很快，但是如果本地的 <code>hosts</code> 文件被修改了，<code>.lookup</code> 就会拿 <code>hosts</code> 文件中的地址，而 <code>.resolve</code> 依旧是外部正常的地址。</p><p>由于 <code>.lookup</code> 是同步的，所以如果由于什么不可控的原因导致 <code>getaddrinfo</code> 缓慢或者阻塞是会影响整个 Node 进程的。</p><h2 id="模块方法"><a aria-hidden="true" href="#模块方法"><span class="icon icon-link"></span></a>模块方法</h2><ul><li><code>dns.lookup(hostname [,options], callback)</code>：将域名解析为第一条找到的记录</li><li><code>dns.resolve(hostname [, rrtype], callback)</code>：将一个域名解析为一个 rrtype 指定记录类型的数组</li><li><code>dns.reverse(ip, callback)</code>：反向解析 IP 地址，指向该 IP 地址的域名数组</li><li><code>dns.getServer()</code>：返回一个用于当前解析的 IP 地址数组的字符串</li><li><code>dns.setServer(servers)</code>：指定一组 IP 地址作为解析服务器</li></ul><p>🌰 <strong>示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const dns = require(&#x27;dns&#x27;);

dns.lookup(&#x27;www.google.com&#x27;, 4, (err, address) =&gt; {
  // do something
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> dns </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;dns&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">dns</span><span class="token punctuation">.</span><span class="token method function property-access">lookup</span><span class="token punctuation">(</span><span class="token string">&#x27;www.google.com&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> address</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="记录类型"><a aria-hidden="true" href="#记录类型"><span class="icon icon-link"></span></a>记录类型</h2><p>域名与 IP 之间的对应关系，称为记录（record）。根据使用场景，记录可以分成不同的类型（type）。</p><p>常见的 DNS 记录类型：</p><ul><li><strong>A</strong>：地址记录（Address），将域名指向一个 IPV4 的地址</li><li><strong>AAAA</strong>：将域名指向一个 IPV6 的地址</li><li><strong>NS</strong>：域名服务器记录（Name Server），将子域名指定其他 DNS 服务器解析。该记录只能设置为域名，不能设置为 IP 地址。</li><li><strong>MX</strong>：邮件记录（Mail eXchange），将域名指向邮件服务器地址。</li><li><strong>CNAME</strong>：规范名称记录（Canonical Name），将域名指向另一个域名，即当前查询的域名是另一个域名的跳转，详见下文。</li><li><strong>PTR</strong>：逆向查询记录（Pointer Record），只用于从 IP 地址查询域名</li><li><strong>TXT</strong>：文本长度限制 512，通常做 SPF 记录（反垃圾邮件）</li><li><strong>CAA</strong>：CA 证书颁发机构授权校验（Certification Authority Authorization）</li><li><strong>SRV</strong>：服务记录（Service Record），记录提供特定的服务的服务器</li><li><strong>显性URL</strong>：将域名 302 重定向到另一个地址</li></ul><p>一般来说，为了服务的安全可靠，至少应该有两条 NS 记录，而 A 记录和 MX 记录也可以有多条，这样就提供了服务的冗余性，防止出现单点失败。</p><h3 id="cname"><a aria-hidden="true" href="#cname"><span class="icon icon-link"></span></a>CNAME</h3><p><strong>CNAME</strong> 记录主要用于域名的内部跳转，为服务器配置提供灵活性，用户感知不到。举例来说，<code>www.baidu.com</code> 这个域名就是一个 CNAME 记录。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="$ dig www.baidu.com

;;ANSWER SECTION:
www.baidu.com     1091  IN   CNAME   www.a.shifen.com
www.a.shifen.com  200   IN     A     14.215.177.39
www.a.shifen.com  200   IN     A     14.215.177.38
" data-status="copy"></button><div class="token-line"><span class="token plain">$ </span><span class="token function">dig</span><span class="token plain"> www.baidu.com</span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token plain">ANSWER SECTION:</span></div><div class="token-line"><span class="token plain">www.baidu.com     </span><span class="token number">1091</span><span class="token plain">  IN   CNAME   www.a.shifen.com</span></div><div class="token-line"><span class="token plain">www.a.shifen.com  </span><span class="token number">200</span><span class="token plain">   IN     A     </span><span class="token number">14.215</span><span class="token plain">.177.39</span></div><div class="token-line"><span class="token plain">www.a.shifen.com  </span><span class="token number">200</span><span class="token plain">   IN     A     </span><span class="token number">14.215</span><span class="token plain">.177.38</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>上面结果显示，<code>www.baidu.com</code> 的 CNAME 记录指向 <code>www.a.shifen.com</code>。也就说，用户查询 <code>www.baidu.com</code> 的时候，实际上返回的是 <code>www.a.shifen.com</code> 的 IP 地址。</p><p>这样的好处是，变更服务器 IP 地址的时候，只要修改 <code>www.a.shifen.com</code> 这个域名就可以了，用户的 <code>www.baidu.com</code> 域名不用修改。</p><p>由于 CNAME 记录就是一个替换，所以域名一旦设置 CNAME 记录以后，就不能再设置其他记录了（比如 A 记录和 MX 记录），这是为了防止产生冲突。举例来说，<code>foo.com</code> 指向 <code>bar.com</code>，而两个域名各有自己的 MX 记录，如果两者不一致，就会产生问题。由于顶级域名通常要设置 MX 记录，所以一般不允许用户对顶级域名设置 CNAME 记录。</p><h3 id="ptr"><a aria-hidden="true" href="#ptr"><span class="icon icon-link"></span></a>PTR</h3><p>PTR 记录用于从 IP 地址反查域名。</p><p>逆向查询的一个应用，是可以防止垃圾邮件，即验证发送邮件的 IP 地址，是否真的有它所声称的域名。</p><h2 id="错误码"><a aria-hidden="true" href="#错误码"><span class="icon icon-link"></span></a>错误码</h2><table><thead><tr><th>错误码</th><th>语义</th></tr></thead><tbody><tr><td>dns.NODATA</td><td>DNS 服务返回没有数据</td></tr><tr><td>dns.FORMERR</td><td>DNS 服务器查询没有格式化</td></tr><tr><td>dns.SERVFAIL</td><td>DNS 服务器返回失败</td></tr><tr><td>dns.NOTFOUND</td><td>域名未找到</td></tr><tr><td>dns.NOIMP</td><td>DNS 服务器不执行请求的操作</td></tr><tr><td>dns.REFUSED</td><td>查询 DNS 服务器拒绝</td></tr><tr><td>dns.BADQUERY</td><td>未格式化 DNS 查询</td></tr><tr><td>dns.BADNAME</td><td>未格式化主机</td></tr><tr><td>dns.BADFAMILY</td><td>没有提供地址族</td></tr><tr><td>dns.BADRESP</td><td>未格式化 DNS 回复</td></tr><tr><td>dns.CONNREFUSED</td><td>无法连接 DNS 服务器</td></tr><tr><td>dns.TIMEOUT</td><td>连接 DNS 服务器超时</td></tr><tr><td>dns.EOF</td><td>文件末尾</td></tr><tr><td>dns.FILE</td><td>读取文件错误</td></tr><tr><td>dns.NOMEM</td><td>内存溢出</td></tr><tr><td>dns.DESTRUCTION</td><td>通道以及销毁</td></tr><tr><td>dns.BADSTR</td><td>未格式化字符串</td></tr><tr><td>dns.BADFLAGS</td><td>指定非法标记</td></tr><tr><td>dns.NONAME</td><td>给定主机名不是数字</td></tr><tr><td>dns.BADHINTS</td><td>指定非法的提示标志</td></tr><tr><td>dns.NOTINITIALIED</td><td>异步 DNS 请求库初始化未完成</td></tr><tr><td>dns.LOADIPHLPAPI</td><td>加载 iphlpapi.dll 错误</td></tr><tr><td>dns.ADDRGETNETWORKPARAMS</td><td>找不到读取本机 DNS 信息函数</td></tr><tr><td>dns.CANCELLED</td><td>DNS 查询取消</td></tr></tbody></table><hr/><p><strong>参考资料：</strong></p><ul><li><a href="http://nodejs.cn/api/dns.html" target="_blank" rel="noopener noreferrer">📖 NodeJS API Documentation：DNS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://juejin.im/post/5a4a2f00f265da431e171da4" target="_blank" rel="noopener noreferrer">📝 从 Chrome 源码看 DNS 解析过程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook/edit/master/docs/network/dns.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/4/2020, 3:39:37 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/node-guidebook/umi.js"></script>
    <script src="/node-guidebook/docs__network__dns.md.js"></script>
  </body>
</html>
