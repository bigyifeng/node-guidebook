<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/node-guidebook/umi.css" />
    <script>
      window.routerBase = "/node-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>HTTP</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//">Node Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/node-guidebook//overview">概览</a><a href="/node-guidebook//engine">引擎</a><a href="/node-guidebook//system">系统</a><a aria-current="page" class="active" href="/node-guidebook//network">网络</a><a href="/node-guidebook//server-application">服务端应用</a><a href="/node-guidebook//util-application">工具应用</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//"></a><h1>Node Guidebook</h1><p>Node 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/node-guidebook//overview">概览</a></li><li><a href="/node-guidebook//engine">引擎</a></li><li><a href="/node-guidebook//system">系统</a></li><li><a aria-current="page" class="active" href="/node-guidebook//network">网络</a></li><li><a href="/node-guidebook//server-application">服务端应用</a></li><li><a href="/node-guidebook//util-application">工具应用</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/node-guidebook//network/socket">Socket 套接字</a></li><li><a href="/node-guidebook//network/dns">DNS 域名服务器</a></li><li><a href="/node-guidebook//network/net">Net 网络</a></li><li><a href="/node-guidebook//network/dgram">Dgram 数据报</a></li><li><a aria-current="page" class="active" href="/node-guidebook//network">HTTP</a><ul><li><a aria-current="page" class="active" href="/node-guidebook//network/http"><span>HTTP</span></a></li><li><a href="/node-guidebook//network/http-server"><span>HTTP Server</span></a></li><li><a href="/node-guidebook//network/http-client-request"><span>HTTP ClientRequest</span></a></li><li><a href="/node-guidebook//network/http-incoming-message"><span>HTTP IncomingMessage</span></a></li><li><a href="/node-guidebook//network/http-server-response"><span>HTTP ServerResponse</span></a></li><li><a href="/node-guidebook//network/https"><span>HTTPS</span></a></li><li><a href="/node-guidebook//network/http2"><span>HTTP2</span></a></li></ul></li><li><a href="/node-guidebook//network/url">URL</a></li><li><a href="/node-guidebook//network/querystring">QueryString 查询字符串</a></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="http.createServer" data-depth="2" class=""><a href="/node-guidebook//network/http#httpcreateserver"><span>http.createServer</span></a></li><li title="发送请求" data-depth="2" class=""><a href="/node-guidebook//network/http#发送请求"><span>发送请求</span></a></li><li title="http.get" data-depth="3" class=""><a href="/node-guidebook//network/http#httpget"><span>http.get</span></a></li><li title="http.request" data-depth="3" class=""><a href="/node-guidebook//network/http#httprequest"><span>http.request</span></a></li><li title="HTTP 类" data-depth="2" class=""><a href="/node-guidebook//network/http#http-类"><span>HTTP 类</span></a></li><li title="http.ClientRequest" data-depth="3" class=""><a href="/node-guidebook//network/http#httpclientrequest"><span>http.ClientRequest</span></a></li><li title="http.Server" data-depth="3" class=""><a href="/node-guidebook//network/http#httpserver"><span>http.Server</span></a></li><li title="http.IncomingMessage" data-depth="3" class=""><a href="/node-guidebook//network/http#httpincomingmessage"><span>http.IncomingMessage</span></a></li><li title="http.ServerResponse" data-depth="3" class=""><a href="/node-guidebook//network/http#httpserverresponse"><span>http.ServerResponse</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="http"><a aria-hidden="true" href="#http"><span class="icon icon-link"></span></a>HTTP</h1><p>Node 的 http 模块包含对 HTTP 处理的封装。在 Node 中，HTTP 服务继承自 TCP 服务器（<a href="/node-guidebook//network/net">net 模块</a>），它能够与多个客户端保持连接，由于其采用事件驱动的形式，并不为每一个连接创建额外的线程或进程，保持很低的内存占用，所以能实现高并发。HTTP 服务与 TCP 服务模型有区别的地方在于，在开启 keepalive 后，一个 TCP 会话可以用于多次请求和响应。TCP 服务以 connection 为单位进行服务，HTTP 服务以 request 为单位进行服务。http 模块即是将 connection 到 request 的过程进行了封装。</p><p>Node.js 采用的网络请求处理模型是 I/O 多路复用，与传统的主从多线程并发模型区别：</p><ul><li>只使用有限的线程数（1 个），所以占用系统资源很少</li><li>操作系统级的异步 I/O 支持，可以减少用户态/内核态切换，并且本身性能更高（因为直接与网卡驱动交互）</li><li>JavaScript 天生具有保护程序执行现场的能力（闭包），传统模型要么依赖应用程序自己保存现场，或者依赖线程切换时自动完成</li></ul><h2 id="httpcreateserver"><a aria-hidden="true" href="#httpcreateserver"><span class="icon icon-link"></span></a>http.createServer</h2><p>通过 <code>http.createServer</code> 工厂方法可以创建一个 HTTP 服务器，返回 <code>http.Server</code> 对象实例，该实例继承自 <code>net.Server</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="http.createServer([requestListener]);
" data-status="copy"></button><div class="token-line"><span class="token plain">http</span><span class="token punctuation">.</span><span class="token method function property-access">createServer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">requestListener</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>事实上，HTTP 协议确实是基于 TCP 协议实现的。</p><p>craeteServer 的可选参数 requestListener 用于监听 request 事件；另外，它也监听 connection 事件，只不过回调函数是 <code>http.Server</code> 自己实现的。然后调用 listen 让 <code>http.Server</code> 对象在端口 3333 上监听连接请求并最终创建 TCP 对象，由 <code>tcp_wrap.h</code> 实现。最后会调用 TCP 对象的 listen 方法，这才是真正在指定端口开始提供服务。</p><p><img src="/node-guidebook/static/network-diagram.da468319.jpg"/></p><p>涉及到 C++的类大多是对 libuv 做了一层包装并公布给 JavaScript，所以不在这里特别列出。我们有必要提 <code>http-parser</code>，它是用来解析 HTTP 请求/响应消息的，本身十分高效：没有任何系统调用，没有内存分配操作，纯 C 实现。</p><h2 id="发送请求"><a aria-hidden="true" href="#发送请求"><span class="icon icon-link"></span></a>发送请求</h2><p>http 模块可以通过 <code>get</code> 和 <code>request</code> 方法发送 HTTP 请求。</p><h3 id="httpget"><a aria-hidden="true" href="#httpget"><span class="icon icon-link"></span></a>http.get</h3><p><code>http.get</code> 方法主要用于发出 GET 请求。</p><p>由于大多数请求都是没有主体的 GET 请求，所以 Node.js 提供了这个便捷的方法。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="http.get(options[, callback])

http.get(url[,options][,callback])
" data-status="copy"></button><div class="token-line"><span class="token plain">http</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token plain">options</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain"> callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">http</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain">options</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain">callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>这个方法与 <code>http.request</code> 方法的区别在于，它将方法设置为 GET 并自动调用 <code>req.end()</code>。</p><p><code>callback</code> 调用时只有一个参数，该参数是 <a href="http-incoming-message.md">http.IncomingMessage</a> 的实例。</p><h3 id="httprequest"><a aria-hidden="true" href="#httprequest"><span class="icon icon-link"></span></a>http.request</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="http.request(options[, callback])

http.request(url[, options][, callback])
" data-status="copy"></button><div class="token-line"><span class="token plain">http</span><span class="token punctuation">.</span><span class="token method function property-access">request</span><span class="token punctuation">(</span><span class="token plain">options</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain"> callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">http</span><span class="token punctuation">.</span><span class="token method function property-access">request</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain"> options</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain"> callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>配置对象 options 属性：</p><table><thead><tr><th>属性</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td>protocol</td><td>使用协议</td><td><code>&#x27;http&#x27;</code></td></tr><tr><td>host</td><td>请求发送至的服务器的域名或 IP 地址</td><td><code>&#x27;localhost&#x27;</code></td></tr><tr><td>hostname</td><td>host 的别名</td><td></td></tr><tr><td>family</td><td>IP 地址族（有效值为 4 或 6）</td><td></td></tr><tr><td>port</td><td>远程服务器的端口</td><td>80</td></tr><tr><td>localAddress</td><td>为网络连接绑定的本地接口</td><td></td></tr><tr><td>socketPath</td><td>Unix 域套接字</td><td></td></tr><tr><td>method</td><td>HTTP 请求方法</td><td><code>&#x27;GET&#x27;</code></td></tr><tr><td>path</td><td>请求路径</td><td><code>&#x27;/&#x27;</code></td></tr><tr><td>headers</td><td>包含请求头的对象</td><td></td></tr><tr><td>auth</td><td>基本的身份验证</td><td></td></tr><tr><td>agent</td><td>控制 Agent 的行为</td><td></td></tr><tr><td>createConnection</td><td>当 agent 未使用时，用来为请求生成套接字或流的函数</td><td></td></tr><tr><td>timeout</td><td>指定套接字超时的数值</td><td></td></tr><tr><td>setHost</td><td>是否自动添加 Host 请求头</td><td>true</td></tr></tbody></table><p>参数 <code>url</code> 可以是字符串或 URL 对象。</p><ul><li>如果是字符串，则会自动使用 <code>url.parse()</code> 解析</li><li>如果是 URL 对象，则会自动转换为普通的 <code>options</code> 对象</li></ul><p>如果同时制定了 <code>url</code> 和 <code>options</code>，则对象会被合并，其中 <code>options</code> 属性优先。</p><p>可选的 <code>callback</code> 参数会作为单次监听器被添加到 <code>response</code> 事件中。</p><p><code>http.request()</code> 放回 <a href="http-client-request.md">http.ClientRequest</a> 类的实例。ClientRequest 实例是一个可写流。如果需要时哟功能 POST 请求上传文件，则写入 ClientRequest 对象。</p><h2 id="http-类"><a aria-hidden="true" href="#http-类"><span class="icon icon-link"></span></a>HTTP 类</h2><p><img src="/node-guidebook/static/http-architect.9d2890d6.jpg"/></p><ul><li><code>http.Agent</code>：负责管理 HTTP 客户端的连接持久性和重用</li><li><code>http.ClientRequest</code>：用于向服务端发起请求，由 <code>http.request</code> 内部创建并返回，表示正在进行的请求，且其请求头已进入队列</li><li><code>http.Server</code>：用于提供 HTTP 服务，处理客户端的请求</li><li><code>http.ServerResponse</code>：由 HTTP 服务器在内部创建，而不是由用户创建</li><li><code>http.IncomingMessage</code>：用于访问响应状态、消息头以及数据</li></ul><h3 id="httpclientrequest"><a aria-hidden="true" href="#httpclientrequest"><span class="icon icon-link"></span></a>http.ClientRequest</h3><p>HTTP 客户端</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const http = require(&#x27;http&#x27;);

const client = http.get(&#x27;http://127.0.0.1:3000&#x27;, function(request) {
  request.pipe(process.stdout);
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> http </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;http&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> client </span><span class="token operator">=</span><span class="token plain"> http</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&#x27;http://127.0.0.1:3000&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  request</span><span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span><span class="token plain">process</span><span class="token punctuation">.</span><span class="token property-access">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>http.ClientRequest</code> 内部创建了一个 Socket 来发起请求。</p><p>当你调用 <code>http.request(options)</code> 时，内部是这样的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="self.onSocket(net.createConnection(options));
" data-status="copy"></button><div class="token-line"><span class="token plain">self</span><span class="token punctuation">.</span><span class="token method function property-access">onSocket</span><span class="token punctuation">(</span><span class="token plain">net</span><span class="token punctuation">.</span><span class="token method function property-access">createConnection</span><span class="token punctuation">(</span><span class="token plain">options</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="httpserver"><a aria-hidden="true" href="#httpserver"><span class="icon icon-link"></span></a>http.Server</h3><p>Web 服务器</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const http = require(&#x27;http&#x27;);

const server = http.createServer(function(request, response) {
  const pathname = request.url;
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> http </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;http&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> server </span><span class="token operator">=</span><span class="token plain"> http</span><span class="token punctuation">.</span><span class="token method function property-access">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token parameter punctuation">,</span><span class="token parameter"> response</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> pathname </span><span class="token operator">=</span><span class="token plain"> request</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li><code>http.Server</code> 继承了 <code>net.Server</code></li><li><code>net.createServer(fn)</code> 回调中的 <code>socket</code> 是个双工的 <code>stream</code> 接口，也就是说，读取发送方信息、向发送方发送信息都靠它实现</li></ul><p>🌰 <strong>标准示例：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 参考：https://cnodejs.org/topic/4fb1c1fd1975fe1e1310490b
var net = require(&#x27;net&#x27;);

var PORT = 8989;
var HOST = &#x27;127.0.0.1&#x27;;

var server = net.createServer(function(socket) {
  console.log(&#x27;Connected: &#x27; + socket.remoteAddress + &#x27;:&#x27; + socket.remotePort);

  socket.on(&#x27;data&#x27;, function(data) {
    console.log(&#x27;DATA &#x27; + socket.remoteAddress + &#x27;: &#x27; + data);
    console.log(&#x27;Data is: &#x27; + data);

    socket.write(&#x27;Data from you is  &quot;&#x27; + data + &#x27;&quot;&#x27;);
  });

  socket.on(&#x27;close&#x27;, function() {
    console.log(&#x27;CLOSED: &#x27; + socket.remoteAddress + &#x27; &#x27; + socket.remotePort);
  });
});
server.listen(PORT, HOST);

console.log(server instanceof net.Server); // true
" data-status="copy"></button><div class="token-line"><span class="token comment">// 参考：https://cnodejs.org/topic/4fb1c1fd1975fe1e1310490b</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> net </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;net&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> </span><span class="token constant">PORT</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">8989</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> </span><span class="token constant">HOST</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;127.0.0.1&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> server </span><span class="token operator">=</span><span class="token plain"> net</span><span class="token punctuation">.</span><span class="token method function property-access">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Connected: &#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> socket</span><span class="token punctuation">.</span><span class="token property-access">remoteAddress</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string">&#x27;:&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> socket</span><span class="token punctuation">.</span><span class="token property-access">remotePort</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  socket</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;data&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;DATA &#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> socket</span><span class="token punctuation">.</span><span class="token property-access">remoteAddress</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string">&#x27;: &#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Data is: &#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    socket</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token string">&#x27;Data from you is  &quot;&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> data </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string">&#x27;&quot;&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  socket</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;close&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;CLOSED: &#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> socket</span><span class="token punctuation">.</span><span class="token property-access">remoteAddress</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string">&#x27; &#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> socket</span><span class="token punctuation">.</span><span class="token property-access">remotePort</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">server</span><span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token constant">HOST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">server </span><span class="token keyword">instanceof</span><span class="token plain"> </span><span class="token class-name">net</span><span class="token class-name punctuation">.</span><span class="token class-name">Server</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="httpincomingmessage"><a aria-hidden="true" href="#httpincomingmessage"><span class="icon icon-link"></span></a>http.IncomingMessage</h3><p><a href="https://github.com/nodejs/node/blob/master/lib/_http_incoming.js" target="_blank" rel="noopener noreferrer">http.IncomingMessage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>获取请求方发送的信息，比如：请求方法、路径、传递的数据等。</p><ul><li>在 Server 端和 Client 端都会出现</li></ul><p>三个需要注意的属性：</p><ul><li>method：只在 Server 端实例中有</li><li>statusCode：只在 Client 端实例中有</li><li>statusMessage：只在 Client 端实例中有</li></ul><h3 id="httpserverresponse"><a aria-hidden="true" href="#httpserverresponse"><span class="icon icon-link"></span></a>http.ServerResponse</h3><p>实现了 Writable Stream interface，内部也是通过 Socket 来发送信息。</p><hr/><p><strong>参考资料：</strong></p><ul><li><a href="https://juejin.im/post/5965bb26f265da6c204195b3" target="_blank" rel="noopener noreferrer">走进 Node.js 之 HTTP 实现分析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook/edit/master/docs/network/http.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/4/2020, 3:39:37 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/node-guidebook/umi.js"></script>
    <script src="/node-guidebook/docs__network__http.md.js"></script>
  </body>
</html>
