<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/node-guidebook/umi.css" />
    <script>
      window.routerBase = "/node-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>HTTP ServerResponse</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//">Node Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/node-guidebook//overview">概览</a><a href="/node-guidebook//engine">引擎</a><a href="/node-guidebook//system">系统</a><a aria-current="page" class="active" href="/node-guidebook//network">网络</a><a href="/node-guidebook//server-application">服务端应用</a><a href="/node-guidebook//util-application">工具应用</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//"></a><h1>Node Guidebook</h1><p>Node 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/node-guidebook//overview">概览</a></li><li><a href="/node-guidebook//engine">引擎</a></li><li><a href="/node-guidebook//system">系统</a></li><li><a aria-current="page" class="active" href="/node-guidebook//network">网络</a></li><li><a href="/node-guidebook//server-application">服务端应用</a></li><li><a href="/node-guidebook//util-application">工具应用</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/node-guidebook//network/socket">Socket 套接字</a></li><li><a href="/node-guidebook//network/dns">DNS 域名服务器</a></li><li><a href="/node-guidebook//network/net">Net 网络</a></li><li><a href="/node-guidebook//network/dgram">Dgram 数据报</a></li><li><a aria-current="page" class="active" href="/node-guidebook//network">HTTP</a><ul><li><a href="/node-guidebook//network/http"><span>HTTP</span></a></li><li><a href="/node-guidebook//network/http-server"><span>HTTP Server</span></a></li><li><a href="/node-guidebook//network/http-client-request"><span>HTTP ClientRequest</span></a></li><li><a href="/node-guidebook//network/http-incoming-message"><span>HTTP IncomingMessage</span></a></li><li><a aria-current="page" class="active" href="/node-guidebook//network/http-server-response"><span>HTTP ServerResponse</span></a></li><li><a href="/node-guidebook//network/https"><span>HTTPS</span></a></li><li><a href="/node-guidebook//network/http2"><span>HTTP2</span></a></li></ul></li><li><a href="/node-guidebook//network/url">URL</a></li><li><a href="/node-guidebook//network/querystring">QueryString 查询字符串</a></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="监听事件" data-depth="2" class=""><a href="/node-guidebook//network/http-server-response#监听事件"><span>监听事件</span></a></li><li title="状态描述信息" data-depth="2" class=""><a href="/node-guidebook//network/http-server-response#状态描述信息"><span>状态描述信息</span></a></li><li title="响应头部" data-depth="2" class=""><a href="/node-guidebook//network/http-server-response#响应头部"><span>响应头部</span></a></li><li title="response.writeHead" data-depth="3" class=""><a href="/node-guidebook//network/http-server-response#responsewritehead"><span>response.writeHead</span></a></li><li title="增删改查" data-depth="3" class=""><a href="/node-guidebook//network/http-server-response#增删改查"><span>增删改查</span></a></li><li title="响应主体" data-depth="2" class=""><a href="/node-guidebook//network/http-server-response#响应主体"><span>响应主体</span></a></li><li title="response.write" data-depth="3" class=""><a href="/node-guidebook//network/http-server-response#responsewrite"><span>response.write</span></a></li><li title="response.end" data-depth="3" class=""><a href="/node-guidebook//network/http-server-response#responseend"><span>response.end</span></a></li><li title="其他方法" data-depth="2" class=""><a href="/node-guidebook//network/http-server-response#其他方法"><span>其他方法</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="http-serverresponse"><a aria-hidden="true" href="#http-serverresponse"><span class="icon icon-link"></span></a>HTTP ServerResponse</h1><p>http.ServerResponse 对象由 HTTP 服务器在内部创建，而不是由用户创建。它作为第二个参数传入 <code>&#x27;request&#x27;</code> 事件。</p><p>该对象实现继承自流。</p><h2 id="监听事件"><a aria-hidden="true" href="#监听事件"><span class="icon icon-link"></span></a>监听事件</h2><table><thead><tr><th>事件</th><th>描述</th></tr></thead><tbody><tr><td>close</td><td><code>response.end()</code> 被调用前，连接就断开了。此时会触发这个事件。</td></tr><tr><td>finish</td><td>响应头和主体的最后一段已经切换到操作系统以通过网络传输发送，并不意味着客户端已经收到消息。</td></tr></tbody></table><h2 id="状态描述信息"><a aria-hidden="true" href="#状态描述信息"><span class="icon icon-link"></span></a>状态描述信息</h2><p>响应请求对象必须包含响应状态码和状态描述信息。通过以下几个方法设置：</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>response.statusCode</td><td>表示刷新响应头发送到客户端的状态码</td></tr><tr><td>response.statusMessage</td><td>表示刷新响应头发送到客户端的状态消息</td></tr><tr><td>response.writeHead</td><td>设置响应头（包括状态码和状态描述信息）</td></tr></tbody></table><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 设置响应状态码
res.statusCode = 200;

// 设置响应状态描述信息
res.statusMessage = &#x27;ok&#x27;;
" data-status="copy"></button><div class="token-line"><span class="token comment">// 设置响应状态码</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">res</span><span class="token punctuation">.</span><span class="token property-access">statusCode</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">200</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 设置响应状态描述信息</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">res</span><span class="token punctuation">.</span><span class="token property-access">statusMessage</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;ok&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>两者差不多，差异点在于</p><ul><li><code>res.writeHead()</code> 可以提供额外的功能，比如设置响应头部。</li><li>当响应头部发送出去后，<code>res.statusCode</code> 和 <code>res.statusMessage</code> 会被设置成已发送出去的状态代码和状态描述信息。</li></ul><h2 id="响应头部"><a aria-hidden="true" href="#响应头部"><span class="icon icon-link"></span></a>响应头部</h2><p>使用以下方法可以对响应头部进行修改等操作：</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td><code>response.writeHead(statusCode[, statusMessage][, headers])</code></td><td>设置响应头，包括状态码、状态描述信息和头部字段</td></tr><tr><td><code>response.setHeader(name, value)</code></td><td>为隐式响应头设置单个响应头的值</td></tr><tr><td>response.removeHeader</td><td>移除排队等候中的隐式发送的响应头</td></tr><tr><td>response.getHeader</td><td>读取已排队但未发送到客户端的响应头</td></tr><tr><td>response.getHeaderNames</td><td>读取响应头名称</td></tr><tr><td>response.getHeaders</td><td>读取已传出的响应头的浅拷贝</td></tr><tr><td>response.hasHeader</td><td>判断是否设置了指定的响应头字段</td></tr></tbody></table><h3 id="responsewritehead"><a aria-hidden="true" href="#responsewritehead"><span class="icon icon-link"></span></a>response.writeHead</h3><p>向请求发送响应头。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="response.write(statusCode[, statusMessage][, headers])
" data-status="copy"></button><div class="token-line"><span class="token plain">response</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token plain">statusCode</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain"> statusMessage</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain"> headers</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li><p>此方法只能在响应对象中调用一次，并且必须在调用 <code>response.end()</code> 之前调用</p></li><li><p>如果在调用此方法之前调用了 <code>response.write()</code> 或 <code>response.end()</code>，则将计算隐式或可变的响应头并调用此函数。</p></li><li><p>当使用 <code>response.setHeader()</code> 设置响应头时，则与传给 <code>response.writeHead()</code> 的任何响应头合并，且 <code>response.writeHead()</code> 的优先。</p></li><li><p>如果调用此方法并且尚未调用 <code>response.setHeader()</code>，则直接将提供的响应头值写入网络通道而不在内部进行缓存，响应头上的 <code>response.getHeader()</code> 将不会产生预期的结果。 如果需要渐进的响应头填充以及将来可能的检索和修改，则改用 <code>response.setHeader()</code>。</p></li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const body = &#x27;Hello world!&#x27;;

response.writeHead(200, {
  &#x27;Content-Length&#x27;: Buffer.byteLength(body),
  &#x27;Content-Type&#x27;: &#x27;text/plain&#x27;,
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> body </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;Hello world!&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">response</span><span class="token punctuation">.</span><span class="token method function property-access">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;Content-Length&#x27;</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">Buffer</span><span class="token punctuation">.</span><span class="token method function property-access">byteLength</span><span class="token punctuation">(</span><span class="token plain">body</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;Content-Type&#x27;</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;text/plain&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>⚠️ <strong>注意</strong>：添加和移除响应头的顺序可以随意，但一定要在调用 <code>res.write()</code> 和 <code>res.end()</code> 之前。</p><h3 id="增删改查"><a aria-hidden="true" href="#增删改查"><span class="icon icon-link"></span></a>增删改查</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 增
response.setHeader(&#x27;Content-Type&#x27;, &#x27;text/plain&#x27;);

// 删
response.removeHeader(&#x27;Content-Type&#x27;);

// 改
response.setHeader(&#x27;Content-Type&#x27;, &#x27;text/plain&#x27;);
response.setHeader(&#x27;Content-Type&#x27;, &#x27;text/html&#x27;); // 覆盖

// 查
response.getHeader(&#x27;content-type&#x27;);
" data-status="copy"></button><div class="token-line"><span class="token comment">// 增</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">response</span><span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">&#x27;Content-Type&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;text/plain&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 删</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">response</span><span class="token punctuation">.</span><span class="token method function property-access">removeHeader</span><span class="token punctuation">(</span><span class="token string">&#x27;Content-Type&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 改</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">response</span><span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">&#x27;Content-Type&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;text/plain&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">response</span><span class="token punctuation">.</span><span class="token method function property-access">setHeader</span><span class="token punctuation">(</span><span class="token string">&#x27;Content-Type&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;text/html&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// 覆盖</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 查</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">response</span><span class="token punctuation">.</span><span class="token method function property-access">getHeader</span><span class="token punctuation">(</span><span class="token string">&#x27;content-type&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>此外，还有不那么常用的：</p><ul><li><strong>response.headersSent</strong>：表示 header 是否已经发送</li></ul><ul><li><strong>response.sendDate</strong>：默认为 <code>true</code>。但为 <code>true</code> 时，会在 response header 里自动设置 Date 首部</li></ul><h2 id="响应主体"><a aria-hidden="true" href="#响应主体"><span class="icon icon-link"></span></a>响应主体</h2><p>主要用到 <code>res.write()</code> 以及 <code>res.end()</code> 两个方法。</p><p><code>res.write()</code> API 的信息量略大，建议看下官方文档。</p><h3 id="responsewrite"><a aria-hidden="true" href="#responsewrite"><span class="icon icon-link"></span></a>response.write</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="response.write(chunk [, encoding][, callback])
" data-status="copy"></button><div class="token-line"><span class="token plain">response</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token plain">chunk </span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain"> encoding</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain"> callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li>如果调用此方法并且尚未调用 <code>response.writeHead()</code>，则将切换到隐式响应头模式并刷新隐式响应头。</li><li>可以多次调用该方法以提供连续的响应主体片段。</li><li>chunk 可以是 String 或 Buffer。如果 chunk 是一个字符串，则第二个参数指定如何将其编码为字节流。</li></ul><p>⚠️ <strong>注意</strong>：在 http 模块中，当请求时 HEAD 请求时，则省略响应主体。同样，204 和 304 响应不得包含消息主体。</p><p>第一次调用 <code>response.write()</code> 时，它会将缓冲的响应头信息和主体的第一个数据块发送给客户端。 第二次调用 <code>response.write()</code> 时，Node.js 假定数据将被流式传输，并分别发送新数据。 也就是说，响应被缓冲到主体的第一个数据块。</p><p>如果将整个数据成功刷新到内核缓冲区，则返回 <code>true</code>。 如果全部或部分数据在用户内存中排队，则返回 <code>false</code>。 当缓冲区再次空闲时，则触发 <code>&#x27;drain&#x27;</code> 事件。</p><h3 id="responseend"><a aria-hidden="true" href="#responseend"><span class="icon icon-link"></span></a>response.end</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="response.end([data][, encoding][, callback])
" data-status="copy"></button><div class="token-line"><span class="token plain">response</span><span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">data</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain"> encoding</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token plain"> callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>完成响应请求并返回客户端。</p><p>有点像个语法糖，可以看成下面两个调用的组合。至于 callback，当响应传递结束后触发。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="response.write(data, encoding);
response.end();
" data-status="copy"></button><div class="token-line"><span class="token plain">response</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token plain">data</span><span class="token punctuation">,</span><span class="token plain"> encoding</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">response</span><span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="其他方法"><a aria-hidden="true" href="#其他方法"><span class="icon icon-link"></span></a>其他方法</h2><ul><li><code>response.finished</code>：是否响应结束</li><li><code>response.sendDate</code>：是否自动设置 Date 头部（默认是 <code>true</code>）。（按 HTTP 协议是必须要的，除非是调试用，不然不要设置为 <code>false</code>）</li><li><code>response.headersSent</code>：响应头部是否已发送（只读属性）。</li><li><code>response.writeContinue()</code>：发送 HTTP/1.1 100 Continue 消息给客户端，提示说服务端愿意接受客户端的请求，请继续发送请求正文（body)。</li></ul></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook/edit/master/docs/network/http-server-response.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/4/2020, 3:39:37 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/node-guidebook/umi.js"></script>
    <script src="/node-guidebook/docs__network__http-server-response.md.js"></script>
  </body>
</html>
