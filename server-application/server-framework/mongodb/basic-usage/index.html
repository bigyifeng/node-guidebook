<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/node-guidebook/umi.css" />
    <script>
      window.routerBase = "/node-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>常用方法</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//">Node Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/node-guidebook//overview">概览</a><a href="/node-guidebook//engine">引擎</a><a href="/node-guidebook//system">系统</a><a href="/node-guidebook//network">网络</a><a aria-current="page" class="active" href="/node-guidebook//server-application">服务端应用</a><a href="/node-guidebook//util-application">工具应用</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//"></a><h1>Node Guidebook</h1><p>Node 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/node-guidebook//overview">概览</a></li><li><a href="/node-guidebook//engine">引擎</a></li><li><a href="/node-guidebook//system">系统</a></li><li><a href="/node-guidebook//network">网络</a></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application">服务端应用</a></li><li><a href="/node-guidebook//util-application">工具应用</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/node-guidebook//server-application/architect">服务端架构设计</a><ul><li><a href="/node-guidebook//server-application/architect"><span>架构设计</span></a></li><li><a href="/node-guidebook//server-application/architect/test"><span>测试设计</span></a></li><li><a href="/node-guidebook//server-application/architect/logger"><span>日志设计</span></a></li><li><a href="/node-guidebook//server-application/architect/gateway"><span>网关设计</span></a></li><li><a href="/node-guidebook//server-application/architect/security"><span>安全设计</span></a></li><li><a href="/node-guidebook//server-application/architect/message-queue"><span>消息队列</span></a></li><li><a href="/node-guidebook//server-application/architect/database"><span>数据库</span></a></li></ul></li><li><a href="/node-guidebook//server-application/message-queue/kalfa">Kalfa</a></li><li><a href="/node-guidebook//server-application/message-queue/rabbitmq">RabbitMQ</a></li><li><a href="/node-guidebook//server-application/message-queue/redis">Redis</a></li><li><a href="/node-guidebook//server-application/server-framework/mysql">MySQL</a></li><li><a href="/node-guidebook//server-application/server-framework/express">Express</a><ul><li><a href="/node-guidebook//server-application/server-framework/express"><span>Express</span></a></li><li><a href="/node-guidebook//server-application/server-framework/express/principle"><span>实现原理</span></a></li></ul></li><li><a href="/node-guidebook//server-application/server-framework/koa">Koa</a><ul><li><a href="/node-guidebook//server-application/server-framework/koa"><span>Koa</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/source-code"><span>源码解析</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-router"><span>koa-router</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-jwt"><span>koa-jwt</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-helmet"><span>koa-helmet</span></a></li></ul></li><li><a href="/node-guidebook//server-application/server-framework/egg">Egg</a><ul><li><a href="/node-guidebook//server-application/server-framework/egg"><span>Egg</span></a></li><li><a href="/node-guidebook//server-application/server-framework/egg/architect"><span>框架架构</span></a></li><li><a href="/node-guidebook//server-application/server-framework/egg/core-feature"><span>核心功能</span></a></li></ul></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application/server-framework/mongodb">MongoDB</a><ul><li><a href="/node-guidebook//server-application/server-framework/mongodb/mongodb"><span>MongoDB</span></a></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application/server-framework/mongodb/basic-usage"><span>常用方法</span></a></li><li><a href="/node-guidebook//server-application/server-framework/mongodb/connections"><span>连接 Connections</span></a></li></ul></li><li><a href="/node-guidebook//server-application/database/mongodb">Database/mongodb</a><ul><li><a href="/node-guidebook//server-application/database/mongodb/aggregate"><span>聚合</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/documents"><span>文档 Documents</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/hooks"><span>钩子函数</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/middleware"><span>中间件 Middleware</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/model-api"><span>Model API</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/models"><span>模型 Models</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/plugins"><span>插件 Plugins</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/populate"><span>填充 Populate</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/queries"><span>查询 Queries</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/schema-types"><span>模式类型 SchemaTypes</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/schemas"><span>模式 Schema</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/subdocuments"><span>子文档 Subdocuments</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/validation"><span>验证 Validation</span></a></li></ul></li><li><a href="/node-guidebook//server-application/pm2">Pm2</a></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="文档查询" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#文档查询"><span>文档查询</span></a></li><li title="查询所有数据项 find" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#查询所有数据项-find"><span>查询所有数据项 find</span></a></li><li title="findById" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#findbyid"><span>findById</span></a></li><li title="findOne" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#findone"><span>findOne</span></a></li><li title="$where" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#where"><span>$where</span></a></li><li title="文档更新" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#文档更新"><span>文档更新</span></a></li><li title="update" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#update"><span>update</span></a></li><li title="updateMany" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#updatemany"><span>updateMany</span></a></li><li title="文档删除" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#文档删除"><span>文档删除</span></a></li><li title="remove" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#remove"><span>remove</span></a></li><li title="前后钩子" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#前后钩子"><span>前后钩子</span></a></li><li title="pre" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#pre"><span>pre</span></a></li><li title="post" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#post"><span>post</span></a></li><li title="查询后处理" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#查询后处理"><span>查询后处理</span></a></li><li title="sort" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#sort"><span>sort</span></a></li><li title="skip" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#skip"><span>skip</span></a></li><li title="limit" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#limit"><span>limit</span></a></li><li title="select" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#select"><span>select</span></a></li><li title="count" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#count"><span>count</span></a></li><li title="distinct" data-depth="3" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#distinct"><span>distinct</span></a></li><li title="文档验证" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#文档验证"><span>文档验证</span></a></li><li title="联表操作" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#联表操作"><span>联表操作</span></a></li><li title="获取列表" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#获取列表"><span>获取列表</span></a></li><li title="获取某项" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#获取某项"><span>获取某项</span></a></li><li title="符合条件的文档数" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#符合条件的文档数"><span>符合条件的文档数</span></a></li><li title="创建单个文档" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#创建单个文档"><span>创建单个文档</span></a></li><li title="更新单个文档" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#更新单个文档"><span>更新单个文档</span></a></li><li title="删除单个文档" data-depth="2" class=""><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage#删除单个文档"><span>删除单个文档</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="常用方法"><a aria-hidden="true" href="#常用方法"><span class="icon icon-link"></span></a>常用方法</h1><h2 id="文档查询"><a aria-hidden="true" href="#文档查询"><span class="icon icon-link"></span></a>文档查询</h2><h3 id="查询所有数据项-find"><a aria-hidden="true" href="#查询所有数据项-find"><span class="icon icon-link"></span></a>查询所有数据项 find</h3><p><strong>语法：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find(conditions, [projection], [options], [callback])
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token plain">conditions</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">projection</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">options</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>第一个参数表示查询条件，第二个参数用于控制返回的字段，第三个参数用于配置查询参数，第四个参数是回调函数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const schema = new mongoose.Schema({ age: Number, name: String })

const model = mongoose.model(&#x27;model&#x27;, schema);

model.find(function(err, docs) {
    console.log(docs);
    // [{ _id: xxx, name: &#x27;xie&#x27;, age: 18 },
    //  { _id: xxx, name: &#x27;jun&#x27;, age: 20 },
    //  { _id: xxx, name: &#x27;xing&#x27;, age: 22 },
    //  { _id: xxx, name: &#x27;star&#x27;, age: 24 } ]
})
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> schema </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">mongoose</span><span class="token class-name punctuation">.</span><span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> model </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;model&#x27;</span><span class="token punctuation">,</span><span class="token plain"> schema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// [{ _id: xxx, name: &#x27;xie&#x27;, age: 18 },</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//  { _id: xxx, name: &#x27;jun&#x27;, age: 20 },</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//  { _id: xxx, name: &#x27;xing&#x27;, age: 22 },</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//  { _id: xxx, name: &#x27;star&#x27;, age: 24 } ]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>找出年龄大于 20 的数据：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find({ age: { $gte: 20 }}, function(err, docs) {
    console.log(docs);
    // [ { _id: xxx, name: &#x27;jun&#x27;, age: 20 },
    //  { _id: xxx, name: &#x27;xing&#x27;, age: 22 },
    //  { _id: xxx, name: &#x27;star&#x27;, age: 24 } ]
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> $gte</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// [ { _id: xxx, name: &#x27;jun&#x27;, age: 20 },</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//  { _id: xxx, name: &#x27;xing&#x27;, age: 22 },</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">//  { _id: xxx, name: &#x27;star&#x27;, age: 24 } ]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>找出年龄大于 20 且名字中包含 <code>xing</code> 的数据：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find({ name: /xing/, age: { $gte: 20 }}, function(err, docs) {
    console.log(docs);
    // [ { _id: xxx, name: &#x27;xing&#x27;, age: 22 } ]
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/xing/</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> $gte</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// [ { _id: xxx, name: &#x27;xing&#x27;, age: 22 } ]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>找出名字中存在 <code>x</code> 的数据，且只输出 <code>name</code> 字段。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find({ name: /x/ }, &#x27;name&#x27;, function(err, docs) {
    console.log(docs);
    // [{ name: &#x27;xie&#x27; }, { name: &#x27;xing&#x27; }]
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/x/</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// [{ name: &#x27;xie&#x27; }, { name: &#x27;xing&#x27; }]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>如果确实不需要 <code>_id</code> 字段输出，可以进行如下设置：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find({ name: /x/ }, { name: 1, _id: 0 }, function(err, docs){
    console.log(docs);
    // [{ name: &#x27;xie&#x27; }, { name: &#x27;xing&#x27; }]
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/x/</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> _id</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// [{ name: &#x27;xie&#x27; }, { name: &#x27;xing&#x27; }]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="findbyid"><a aria-hidden="true" href="#findbyid"><span class="icon icon-link"></span></a>findById</h3><p><strong>语法：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.findById(id, [projection], [options], [callback])
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">projection</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">options</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const id = &#x27;xxx&#x27;

model.findById(id, { lean: true }).exec(function(err, doc){
    console.log(doc);
    // { _id: xxx }
})
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> id </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&#x27;xxx&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> lean</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">doc</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// { _id: xxx }</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="findone"><a aria-hidden="true" href="#findone"><span class="icon icon-link"></span></a>findOne</h3><p>该方法返回查找到的所有实例的第一个实例。</p><p><strong>语法：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.findOne([conditions], [projection], [options], [callback])
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">conditions</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">projection</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">options</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>查询 <code>age &gt; 20</code> 的文档中的第一个文档。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.findOne({ age: { $gt: 20 }}, function(err, doc) {
    console.log(doc);
    // { _id: xxx, name: &#x27;jun&#x27;, age: 22 }
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> $gt</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">doc</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// { _id: xxx, name: &#x27;jun&#x27;, age: 22 }</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>查询 <code>age &gt; 20</code> 的文档中的第一个文档，且只输出 <code>nmae</code> 字段。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.findOne({ age: { $gt: 20 }}, { name: 1, _id: 0 }, function(err, doc) {
    console.log(doc);
    // { name: &#x27;jun&#x27; }
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> $gt</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> _id</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">doc</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// { name: &#x27;jun&#x27; }</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>查询 <code>age &gt; 20</code> 的文档中的第一个文档，且输出包含 <code>name</code> 字段在内的最短字段。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.findOne({ age: { $gt: 20 }}, &#x27;name&#x27;, { lean: true }, function(err, doc){
    console.log(doc);
    // { _id: xxx, name: &#x27;jun&#x27; }
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> $gt</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> lean</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">doc</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// { _id: xxx, name: &#x27;jun&#x27; }</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>文档查询中，常用的查询条件：</p><table><thead><tr><th>查询标识</th><th>描述</th></tr></thead><tbody><tr><td><code>$or</code></td><td>或关系</td></tr><tr><td><code>$nor</code></td><td>或关系取反</td></tr><tr><td><code>$gt</code></td><td>大于</td></tr><tr><td><code>$gte</code></td><td>大于等于</td></tr><tr><td><code>$lt</code></td><td>小于</td></tr><tr><td><code>$lte</code></td><td>小于等于</td></tr><tr><td><code>$ne</code></td><td>不等于</td></tr><tr><td><code>$in</code></td><td>在多个值范围内</td></tr><tr><td><code>$nin</code></td><td>不在多个值范围内</td></tr><tr><td><code>$all</code></td><td>匹配数组中多个值</td></tr><tr><td><code>$regex</code></td><td>正则，用于模糊查询</td></tr><tr><td><code>$size</code></td><td>匹配数组大小</td></tr><tr><td><code>$maxDistance</code></td><td>范围查询，距离（基于LBS）</td></tr><tr><td><code>$mod</code></td><td>取模运算</td></tr><tr><td><code>$near</code></td><td>领域查询，查询附近的位置（基于LBS）</td></tr><tr><td><code>$exists</code></td><td>字段是否存在</td></tr><tr><td><code>$elemMatch</code></td><td>匹配内数组内的元素</td></tr><tr><td><code>$within</code></td><td>范围查询（基于LBS）</td></tr><tr><td><code>$box</code></td><td>范围查询，矩形范围（基于LBS）</td></tr><tr><td><code>$center</code></td><td>范围查询，圆形范围（基于LBS）</td></tr><tr><td><code>$centerSphere</code></td><td>范围查询，球形查询（基于LBS）</td></tr><tr><td><code>$slice</code></td><td>查询字段集合中的元素（比如从第几个之后，第N到第M个元素）</td></tr></tbody></table><h3 id="where"><a aria-hidden="true" href="#where"><span class="icon icon-link"></span></a>$where</h3><p>如果要进行更复杂的查询，需要使用 <code>$where</code> 操作符，<code>$where</code> 操作符功能强大而灵活，它可以使用任意的 JavaScript 作为查询的一部分，包含 JavaScript 表达式的字符串或 JavaScript 函数。</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="&gt; db.model.find()
&lt; &quot;_id&quot;: ObjecId&lt;001&gt;, &quot;name&quot;: &#x27;xie&#x27;, &quot;age&quot;: 18, &quot;x&quot;: 1, &quot;y&quot;: 2 &gt;
&lt; &quot;_id&quot;: ObjecId&lt;002&gt;, &quot;name&quot;: &#x27;jun&#x27;, &quot;age&quot;: 20, &quot;x&quot;: 1, &quot;y&quot;: 1 &gt;
&lt; &quot;_id&quot;: ObjecId&lt;003&gt;, &quot;name&quot;: &#x27;xing&#x27;, &quot;age&quot;: 22, &quot;x&quot;: 2, &quot;y&quot;: 1 &gt;
&lt; &quot;_id&quot;: ObjecId&lt;004&gt;, &quot;name&quot;: &#x27;star&#x27;, &quot;age&quot;: 24, &quot;x&quot;: 2, &quot;y&quot;: 2 &gt;
" data-status="copy"></button><div class="token-line"><span class="token operator">&gt;</span><span class="token plain"> db.model.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> ObjecId</span><span class="token operator">&lt;</span><span class="token plain">00</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&#x27;xie&#x27;</span><span class="token plain">, </span><span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">18</span><span class="token plain">, </span><span class="token string">&quot;x&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">, </span><span class="token string">&quot;y&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> ObjecId</span><span class="token operator">&lt;</span><span class="token plain">00</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&#x27;jun&#x27;</span><span class="token plain">, </span><span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain">, </span><span class="token string">&quot;x&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain">, </span><span class="token string">&quot;y&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> ObjecId</span><span class="token operator">&lt;</span><span class="token plain">00</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&#x27;xing&#x27;</span><span class="token plain">, </span><span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">22</span><span class="token plain">, </span><span class="token string">&quot;x&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">, </span><span class="token string">&quot;y&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> ObjecId</span><span class="token operator">&lt;</span><span class="token plain">00</span><span class="token operator file-descriptor important">4</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&#x27;star&#x27;</span><span class="token plain">, </span><span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">24</span><span class="token plain">, </span><span class="token string">&quot;x&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain">, </span><span class="token string">&quot;y&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><strong>字符串</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find({ $where: &#x27;this.x === this.y&#x27; }, function(err, docs){
  console.log(docs);
  // [ { _id: &#x27;002&#x27;, name: &#x27;jun&#x27;, age: 20, x: 1, y: 1 },
  //   { _id: &#x27;004&#x27;, name: &#x27;star&#x27;, age: 24, x: 2, y: 2 } ]
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> $where</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;this.x === this.y&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// [ { _id: &#x27;002&#x27;, name: &#x27;jun&#x27;, age: 20, x: 1, y: 1 },</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">//   { _id: &#x27;004&#x27;, name: &#x27;star&#x27;, age: 24, x: 2, y: 2 } ]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><strong>函数</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find({ $where: function() {
  return this.x !== this.y
}}, function(err, docs){
  console.log(docs);
  // [ { _id: &#x27;002&#x27;, name: &#x27;jun&#x27;, age: 20, x: 1, y: 1 },
  //   { _id: &#x27;004&#x27;, name: &#x27;star&#x27;, age: 24, x: 2, y: 2 } ]
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token function-variable function">$where</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">y</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// [ { _id: &#x27;002&#x27;, name: &#x27;jun&#x27;, age: 20, x: 1, y: 1 },</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">//   { _id: &#x27;004&#x27;, name: &#x27;star&#x27;, age: 24, x: 2, y: 2 } ]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="文档更新"><a aria-hidden="true" href="#文档更新"><span class="icon icon-link"></span></a>文档更新</h2><p>文档更新的方法：</p><ul><li><code>update()</code></li><li><code>updateMany()</code></li><li><code>find()</code> + <code>save()</code></li><li><code>findByIdAndUpdate()</code></li><li><code>findOneAndUpdate()</code></li></ul><h3 id="update"><a aria-hidden="true" href="#update"><span class="icon icon-link"></span></a>update</h3><p><strong>语法：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.update(conditions, doc, [options], [callback])
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token plain">conditions</span><span class="token punctuation">,</span><span class="token plain"> doc</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">options</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>配置选项：</p><table><thead><tr><th>选项</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>safe</td><td>true</td><td>安全模式</td></tr><tr><td>upsert</td><td>false</td><td>如果不存在则创建新纪录</td></tr><tr><td>multi</td><td>false</td><td>是否更新多个查询记录</td></tr><tr><td>runValidators</td><td>false</td><td>执行 Validation 验证</td></tr><tr><td>setDefaultsOnInsert</td><td>true</td><td>在新建插入文档定义的默认值</td></tr><tr><td>strict</td><td></td><td>以 strict 模式进行更新</td></tr><tr><td>overwrite</td><td>false</td><td>禁用 <code>update-only</code> 模式，允许覆盖记录</td></tr></tbody></table><p>🌰 <strong>示例：</strong></p><p>通过 <code>update()</code> 查询 <code>age</code> 大于 20 的数据，并将年龄更改为 40 岁。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.update({ age: { $gte: 20 }}, { age: 40 }, function(err, raw) {
  console.log(raw)
  // { n: 1, nModified: 1, ok: 1 }
})
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> $gte</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">40</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> raw</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">raw</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// { n: 1, nModified: 1, ok: 1 }</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>更改后数据库中，只有第一个数据更改为 40 岁，而其它三个数据没有发生变化：</p><div class="__dumi-default-code-block"><pre class="prism-code language-bash"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="&gt; db.model.find()
&lt; &quot;_id&quot;: ObjecId&lt;001&gt;, &quot;name&quot;: &#x27;xie&#x27;, &quot;age&quot;: 18 &gt;
&lt; &quot;_id&quot;: ObjecId&lt;002&gt;, &quot;name&quot;: &#x27;jun&#x27;, &quot;age&quot;: 40&gt;
&lt; &quot;_id&quot;: ObjecId&lt;003&gt;, &quot;name&quot;: &#x27;xing&#x27;, &quot;age&quot;: 22&gt;
&lt; &quot;_id&quot;: ObjecId&lt;004&gt;, &quot;name&quot;: &#x27;star&#x27;, &quot;age&quot;: 24&gt;
" data-status="copy"></button><div class="token-line"><span class="token operator">&gt;</span><span class="token plain"> db.model.find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> ObjecId</span><span class="token operator">&lt;</span><span class="token plain">00</span><span class="token operator file-descriptor important">1</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&#x27;xie&#x27;</span><span class="token plain">, </span><span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">18</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> ObjecId</span><span class="token operator">&lt;</span><span class="token plain">00</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&#x27;jun&#x27;</span><span class="token plain">, </span><span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">4</span><span class="token operator file-descriptor important">0</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> ObjecId</span><span class="token operator">&lt;</span><span class="token plain">00</span><span class="token operator file-descriptor important">3</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&#x27;xing&#x27;</span><span class="token plain">, </span><span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token operator file-descriptor important">2</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token operator">&lt;</span><span class="token plain"> </span><span class="token string">&quot;_id&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> ObjecId</span><span class="token operator">&lt;</span><span class="token plain">00</span><span class="token operator file-descriptor important">4</span><span class="token operator">&gt;</span><span class="token plain">, </span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token string">&#x27;star&#x27;</span><span class="token plain">, </span><span class="token string">&quot;age&quot;</span><span class="token builtin class-name">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token operator file-descriptor important">4</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>如果要同时更新多个记录，需要设置 options 参数中的<code>multi</code> 为 <code>true</code>。</p><p>下面将名字中有 <code>&#x27;x&#x27;</code> 字符的年龄设置为 10 岁。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.update({ name: /x/ }, { age: 10 }, { multi: true }, function(err, raw){
  console.log(raw);
  // { n: 2, nModified: 2, ok: 1}
})
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/x/</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> multi</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> raw</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">raw</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// { n: 2, nModified: 2, ok: 1}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>如果设置的查找条件，数据库中的数据并不满足，默认什么事都不会发生。</p><h3 id="updatemany"><a aria-hidden="true" href="#updatemany"><span class="icon icon-link"></span></a>updateMany</h3><p><code>updateMany()</code> 与 <code>update()</code>  方法唯一的区别就是默认更新多个文档，即使设置 <code>{<!-- --> multi: false <!-- -->}</code> 也无法只更新第一个文档。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.updateMany(conditions, doc, [options], [callback])
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">updateMany</span><span class="token punctuation">(</span><span class="token plain">conditions</span><span class="token punctuation">,</span><span class="token plain"> doc</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">options</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>更新数据库中名称带有 <code>&#x27;x&#x27;</code> 的数据，年龄变为 50 岁：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.updateMany({ name: /x/ }, { age: 50 }, function(err, raw) {
  console.log(raw);
  // { n: 2, nModified: 2, ok: 1 }
})
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/x/</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">50</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> raw</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">raw</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// { n: 2, nModified: 2, ok: 1 }</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="findbyidandupdate"><a aria-hidden="true" href="#findbyidandupdate"><span class="icon icon-link"></span></a>findByIdAndUpdate</h4><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.findByIdAndUpdate(id, { name: &#x27;xxx&#x27;, age: &#x27;xxx&#x27; })
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">findByIdAndUpdate</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;xxx&#x27;</span><span class="token punctuation">,</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;xxx&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="文档删除"><a aria-hidden="true" href="#文档删除"><span class="icon icon-link"></span></a>文档删除</h2><p>有三种方法用于文档删除：</p><ul><li><code>remove()</code></li><li><code>findOneAndRemove()</code></li><li><code>findByIdAndRemove()</code></li></ul><h3 id="remove"><a aria-hidden="true" href="#remove"><span class="icon icon-link"></span></a>remove</h3><p><code>remove</code> 有两种形式，一种文档的 <code>remove()</code> 方法，一种是 Model 的 <code>remove()</code> 方法。</p><p><strong>语法：</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.remove(conditions, [callback])
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token plain">conditions</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>删除数据库中名称包括  30 的数据。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.remove({ name: /30/ }, function(err){})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/30/</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>⚠️ <strong>注意</strong>：<code>remove()</code> 方法中的回调函数不能省略，否则数据不会被删除。当然，可以使用 <code>exec()</code> 方法来简写代码。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.remove({ name: /30/ }).exec()
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/30/</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>文档的 <code>remove()</code> 方法：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="document.remvoe([callback])
" data-status="copy"></button><div class="token-line"><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">remvoe</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token plain">callback</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>删除数据库中名称包含 <code>xie</code> 的数据：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find({ name: /xie/ }, function(err, doc){
  doc.forEach(function(item, index, arr){
    item.remove(function(err, doc){
      console.log(doc);
      // { _id: xxx, name: &#x27;xie&#x27;, age: 18 }
    })
  })
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/xie/</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  doc</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token parameter punctuation">,</span><span class="token parameter"> index</span><span class="token parameter punctuation">,</span><span class="token parameter"> arr</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    item</span><span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">doc</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// { _id: xxx, name: &#x27;xie&#x27;, age: 18 }</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="前后钩子"><a aria-hidden="true" href="#前后钩子"><span class="icon icon-link"></span></a>前后钩子</h2><p>前后钩子即 <code>pre()</code> 和 <code>post()</code> 方法，又称为中间件，是在执行某些操作时可以执行的函数。中间件在 Schema 上指定，类似于静态方法或实例方法等。</p><p>可以在数据库执行下列操作时，设置前后钩子：</p><ul><li><code>init()</code></li><li><code>validate()</code></li><li><code>save()</code></li><li><code>remove()</code></li><li><code>count()</code></li><li><code>find()</code></li><li><code>findOne()</code></li><li><code>findOneAndRemove()</code></li><li><code>findOneAndUpdate()</code></li><li><code>insertMany()</code></li><li><code>update()</code></li></ul><h3 id="pre"><a aria-hidden="true" href="#pre"><span class="icon icon-link"></span></a>pre</h3><p>以 <code>find()</code> 为例，在执行 <code>find()</code> 方法之前，执行 <code>pre()</code> 方法。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const schema = new mongoose.Schema({
  age: Number,
  name: String,
  x: Number,
  y: Number,
})

schema.pre(&#x27;find&#x27;, function(next){
  console.log(&#x27;1&#x27;)
  next()
})

schema.pre(&#x27;find&#x27;, function(next){
  console.log(&#x27;2&#x27;)
})

const model = mongoose.model(&#x27;model&#x27;, schema);

model.find(function(err, docs){
  console.log(docs[0])
  // 1
  // 2
  // { _id: xxx, name: &#x27;xie&#x27;, age: 18, x: 1, y: 2 }
})
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> schema </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">mongoose</span><span class="token class-name punctuation">.</span><span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  x</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  y</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">schema</span><span class="token punctuation">.</span><span class="token method function property-access">pre</span><span class="token punctuation">(</span><span class="token string">&#x27;find&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;1&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">schema</span><span class="token punctuation">.</span><span class="token method function property-access">pre</span><span class="token punctuation">(</span><span class="token string">&#x27;find&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;2&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> model </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;model&#x27;</span><span class="token punctuation">,</span><span class="token plain"> schema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// { _id: xxx, name: &#x27;xie&#x27;, age: 18, x: 1, y: 2 }</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="post"><a aria-hidden="true" href="#post"><span class="icon icon-link"></span></a>post</h3><p><code>post()</code> 方法并不是在执行某些操作后再去执行的方法，而在执行某些操作前最后执行的方法，<code>post()</code> 方法里不可以使用 <code>next()</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const schema = new mongoose.Schema({ age: Number, name: String, x: Number, y: Number });
schema.post(&#x27;find&#x27;, function(docs){
  console.log(&#x27;1&#x27;)
})
schema.post(&#x27;find&#x27;, function(docs){
  console.log(&#x27;2&#x27;)
})

const model = mongoose.model(&#x27;model&#x27;, schema);
model.find(function(err, docs){
  console.log(docs[0])
  // 1
  // 2
  // { _id: xxx, name: &#x27;xie&#x27;, age: 18, x: 1, y: 2 }
})
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> schema </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">mongoose</span><span class="token class-name punctuation">.</span><span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation">,</span><span class="token plain"> x</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span><span class="token plain"> y</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">schema</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&#x27;find&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;1&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">schema</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&#x27;find&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;2&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> model </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;model&#x27;</span><span class="token punctuation">,</span><span class="token plain"> schema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// 2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// { _id: xxx, name: &#x27;xie&#x27;, age: 18, x: 1, y: 2 }</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="查询后处理"><a aria-hidden="true" href="#查询后处理"><span class="icon icon-link"></span></a>查询后处理</h2><p>常用的查询后处理方法：</p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>sort</td><td>排序</td></tr><tr><td>skip</td><td>跳过</td></tr><tr><td>limit</td><td>限制</td></tr><tr><td>select</td><td>显示字段</td></tr><tr><td>exect</td><td>执行</td></tr><tr><td>count</td><td>计数</td></tr><tr><td>distinct</td><td>去重</td></tr></tbody></table><h3 id="sort"><a aria-hidden="true" href="#sort"><span class="icon icon-link"></span></a>sort</h3><p>按 <code>age</code> 字段从大到小排序，按 <code>x</code> 从小到大。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find().sort(&#x27;-age&#x27;).exec(function(err, docs){
  console.log(docs);
  // [{ _id: xxx, name: &#x27;star&#x27;, age: 24, x: 2, y: 2 },
  //  { _id: xxx, name: &#x27;xing&#x27;, age: 22, x: 2, y: 1 },
  //  { _id: xxx, name: &#x27;jun&#x27;, age: 20, x: 1, y: 2 },
  //  { _id: xxx, name: &#x27;xie&#x27;, age: 18, x: 1, y: 1 }]
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token string">&#x27;-age&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// [{ _id: xxx, name: &#x27;star&#x27;, age: 24, x: 2, y: 2 },</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">//  { _id: xxx, name: &#x27;xing&#x27;, age: 22, x: 2, y: 1 },</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">//  { _id: xxx, name: &#x27;jun&#x27;, age: 20, x: 1, y: 2 },</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">//  { _id: xxx, name: &#x27;xie&#x27;, age: 18, x: 1, y: 1 }]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="skip"><a aria-hidden="true" href="#skip"><span class="icon icon-link"></span></a>skip</h3><p>跳过 2 个，显示其它。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find().skip(2).exec(function(err, docs){
  console.log(docs);
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="limit"><a aria-hidden="true" href="#limit"><span class="icon icon-link"></span></a>limit</h3><p>显示 2 个。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find().limit(2).exec(function(err, docs){
  console.log(docs);
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="select"><a aria-hidden="true" href="#select"><span class="icon icon-link"></span></a>select</h3><p>显示 <code>name</code>、<code>age</code> 字段，不显示 <code>_id</code> 字段。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find().select(&#x27;name age -_id&#x27;).exec(function(err, docs){
  console.log(docs);
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token string">&#x27;name age -_id&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-jS"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find().select({ name: 1, age: 1, _id: 0 }).exec(function(err, docs){
  console.log(docs);
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model.find().select({ name: 1, age: 1, _id: 0 }).exec(function(err, docs){</span></div><div class="token-line"><span class="token plain">  console.log(docs);</span></div><div class="token-line"><span class="token plain">})</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="count"><a aria-hidden="true" href="#count"><span class="icon icon-link"></span></a>count</h3><p>显示集合中的文档数量。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find().count()
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="distinct"><a aria-hidden="true" href="#distinct"><span class="icon icon-link"></span></a>distinct</h3><p>获取集合中某个字段的值。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="model.find().distinct(&#x27;age&#x27;, function(err, distinct){
  console.log(distinct);
})
" data-status="copy"></button><div class="token-line"><span class="token plain">model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">distinct</span><span class="token punctuation">(</span><span class="token string">&#x27;age&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> distinct</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">distinct</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="文档验证"><a aria-hidden="true" href="#文档验证"><span class="icon icon-link"></span></a>文档验证</h2><p>常用验证包括以下几种：</p><table><thead><tr><th>验证项</th><th>说明</th></tr></thead><tbody><tr><td>required</td><td>必填项</td></tr><tr><td>default</td><td>默认值</td></tr><tr><td>validate</td><td>自定义匹配</td></tr><tr><td>min</td><td>最小值（只适用于数字）</td></tr><tr><td>max</td><td>最大值（只适用于数字）</td></tr><tr><td>match</td><td>正则匹配（只适用于字符串）</td></tr><tr><td>enum</td><td>枚举匹配（只适用于字符串）</td></tr></tbody></table><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const schema = new mongoose.Schema({
  name: { type: String, required: true },
  age: { type: Number, default: 18, min: 0, max: 20 },
  desc: { type: String, match: /a/, validate: validateLength },
  color: { type: String, enum: [&#x27;red&#x27;, &#x27;blue&#x27;, &#x27;yellow&#x27;, &#x27;green&#x27;],
})

function validateLength = function(arg){
  if (arg.length &gt; 4){
    return true
  }
  return false
}
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> schema </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">mongoose</span><span class="token class-name punctuation">.</span><span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation">,</span><span class="token plain"> required</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">18</span><span class="token punctuation">,</span><span class="token plain"> min</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> max</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">20</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  desc</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation">,</span><span class="token plain"> match</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/a/</span><span class="token punctuation">,</span><span class="token plain"> validate</span><span class="token punctuation">:</span><span class="token plain"> validateLength </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  color</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">enum</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;red&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;blue&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;yellow&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;green&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function-variable function">validateLength</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">arg</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="联表操作"><a aria-hidden="true" href="#联表操作"><span class="icon icon-link"></span></a>联表操作</h2><p>联表操作：<code>population</code></p><p>以类别 category 和文章 article 之间的关联为例：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 类别模型定义
const mongoose = require(&#x27;mongoose&#x27;);
const Schema = mongoose.Schema;

const CatrgotySchema = new Schema({
  name: { type: String, required: true, validate: { validator: (v) =&gt; v.trim().length, message: &#x27;名称不能为空&#x27; } },
  description: { type: String },
  articles: [{ type: Schema.Types.ObjectId, ref: &#x27;Article&#x27; }],
  recommend: { type: Boolean },
  index: { type: Number },
}, { timestamps: true })

module.exports = mongoose.model(&#x27;Category&#x27;, CategorySchema);
" data-status="copy"></button><div class="token-line"><span class="token comment">// 类别模型定义</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> mongoose </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mongoose&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Schema</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">CatrgotySchema</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation">,</span><span class="token plain"> required</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> validate</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token function-variable function">validator</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> v</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;名称不能为空&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  description</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  articles</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Types</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ObjectId</span><span class="token punctuation">,</span><span class="token plain"> ref</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Article&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  recommend</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Boolean</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  index</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> timestamps</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Category&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token maybe-class-name">CategorySchema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 文章模型定义
const mongoose = require(&#x27;mongoose&#x27;);
const Schema = mongoose.Schema;

const ArticleSchema = new Schema({
  title: { type: String, required: true, unique: true },
    description: { type: String },
  content: { type: String },
  category: { type: Schema.Types.ObjectId, ref: &#x27;Category&#x27;, index: true },
  comments: [{ type: Schema.Types.ObjectId, ref: &#x27;Comment&#x27; }],
  likes: [{ types: Schema.Types.ObjectId, ref: &#x27;Like&#x27; }],
  imgUrl: { type: String },
  recommend: { type: Boolean },
  index: { type: Number }
}, {
  timestamps: true
})
" data-status="copy"></button><div class="token-line"><span class="token comment">// 文章模型定义</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> mongoose </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mongoose&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Schema</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">ArticleSchema</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  title</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation">,</span><span class="token plain"> required</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"> unique</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    description</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  content</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  category</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Types</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ObjectId</span><span class="token punctuation">,</span><span class="token plain"> ref</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Category&#x27;</span><span class="token punctuation">,</span><span class="token plain"> index</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  comments</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Types</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ObjectId</span><span class="token punctuation">,</span><span class="token plain"> ref</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Comment&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  likes</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"> types</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Types</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ObjectId</span><span class="token punctuation">,</span><span class="token plain"> ref</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Like&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  imgUrl</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  recommend</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Boolean</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  index</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  timestamps</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>在对类别的操作中，都需要使用 <code>populate</code> 操作符显示出所包括的 Article 中的 <code>title</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="/* 加载所有类别 */
app.get(&#x27;/catrgories&#x27;, (req, res) =&gt; {
  Category.find().populate(&#x27;articles&#x27;, &#x27;title&#x27;).select(&#x27;number name description recommend index&#x27;).exec((err, doc) =&gt; {
    if (err) return res.status(500).json({ code: 0, message: err.message, err })

    return res.status(200).json({ code: 1, message: &#x27;获取类别成功&#x27;, result:{ doc } })
  })
})

/* 新增一个类别 */
app.post(&#x27;/categories&#x27;, adminAuth, (req, res) =&gt; {
  new Category(req.body).save((err, doc) =&gt; {
    if (err) return res.status(500).json({ code: 0, message: err.message, err })
    doc.populate({ path: &#x27;articles&#x27;, select: &#x27;title&#x27; }, (err, doc) =&gt; {
      if (err) return res.status(500).json({ code: 0, message: err.message, err })

            return res.status(200).json({ code: 1, message: &#x27;新增成功&#x27;, result: { doc } })
    })
  })
})
" data-status="copy"></button><div class="token-line"><span class="token comment">/* 加载所有类别 */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">app</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/catrgories&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">Category</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token string">&#x27;articles&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;title&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token string">&#x27;number name description recommend index&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;获取类别成功&#x27;</span><span class="token punctuation">,</span><span class="token plain"> result</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token plain"> doc </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">/* 新增一个类别 */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">app</span><span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">&#x27;/categories&#x27;</span><span class="token punctuation">,</span><span class="token plain"> adminAuth</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Category</span><span class="token punctuation">(</span><span class="token plain">req</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    doc</span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> path</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;articles&#x27;</span><span class="token punctuation">,</span><span class="token plain"> select</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;title&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;新增成功&#x27;</span><span class="token punctuation">,</span><span class="token plain"> result</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> doc </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>在对文章的操作中，则需要显示出类别 catrgory 的 number 属性。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="/* 按照ID加载一篇文章 */
app.get(&#x27;/articles/:id&#x27;, (req, res) =&gt; {
  Article.findById(req.params.id).populate(&#x27;category&#x27;, &#x27;number&#x27;).exec((err, doc) =&gt; {
    if (err) return res.status(500).json({ code: 0, message: err.message, err })

    if (doc === null) return res.status(404).json({ code: 0, message: &#x27;文章不存在&#x27; })

    return res.status(200).json({ code: 1, message: &#x27;获取文章成功&#x27;, result: { doc } })
  })
})

/* 加载所有文章 */
app.get(&#x27;/articles&#x27;, (req, res) =&gt; {
  Article.find().select(&#x27;title likes comments recommend imgUrl index&#x27;).populate(&#x27;category&#x27;, &#x27;number&#x27;).sort(&#x27;-createdAt&#x27;).exec((err, docs) =&gt; {
    if (err) return res.status(500).json({ code: 0, message: err.message, err })
  })
})
" data-status="copy"></button><div class="token-line"><span class="token comment">/* 按照ID加载一篇文章 */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">app</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/articles/:id&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">Article</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span><span class="token plain">req</span><span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token string">&#x27;category&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;number&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">doc </span><span class="token operator">===</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;文章不存在&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;获取文章成功&#x27;</span><span class="token punctuation">,</span><span class="token plain"> result</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> doc </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">/* 加载所有文章 */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">app</span><span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">&#x27;/articles&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">Article</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token string">&#x27;title likes comments recommend imgUrl index&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token string">&#x27;category&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;number&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token string">&#x27;-createdAt&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>在新增、更新和删除文章的操作中，都需要重建与 catrgory 的关联。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="/* 关联 category 的 articles 数组 */
relateCategory = (id) =&gt; {
  Category.findById(id).exec((err, categoryDoc) =&gt; {
    if (err) return res.status(500).json({ code: 0, message: err.message, err })

    if (categoryDoc === null) return res.status(404).json({ code: 0, message: &#x27;该类别不存在，请刷新后再试&#x27; })

    Article.find({ category: id }).exec((err, articleDocs) =&gt; {
      if (err) return res.status(500).json({ code: 0, message: err.message, err })

      categoryDoc.articles = articleDocs.map(t =&gt; t._id)
      categoryDoc.save(err =&gt; {
        if (err) return res.status(500).json({ code: 0, message: err.message, err })
      })
    })
  })
}

/* 按照 ID 更新一篇文章 */
app.put(&#x27;/articles/:id&#x27;, adminAuth, (req, res) =&gt; {
  Article.findById(req.params.id).exec((err, doc) =&gt; {
    if (err) return res.status(500).json({ status: 0, message: err.message, err })

    if (doc === null) return res.status(404).json({ code: 0, message: &#x27;文章不存在，请刷新后再试&#x27; });
    for (prop in req.body) {
      doc[prop] = req.body[prop]
    }
    doc.save((err) =&gt; {
      if (err) return res.status(500).json({ code: 0, message: err.message, err })
      doc.populate({ path: &#x27;category&#x27;, select: &#x27;number&#x27; }, (err, doc) =&gt; {
        if (err) return res.status(500).json({ code: 0, message: err.message, err })

        relateCategory(doc.category._id);

        return res.status(200).json({ code: 1, message: &#x27;更新成功&#x27;, result: { doc } })
      })
    })
  })
})
" data-status="copy"></button><div class="token-line"><span class="token comment">/* 关联 category 的 articles 数组 */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function-variable function">relateCategory</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">Category</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> categoryDoc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">categoryDoc </span><span class="token operator">===</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;该类别不存在，请刷新后再试&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token maybe-class-name">Article</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> category</span><span class="token punctuation">:</span><span class="token plain"> id </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> articleDocs</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">      categoryDoc</span><span class="token punctuation">.</span><span class="token property-access">articles</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> articleDocs</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      categoryDoc</span><span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">/* 按照 ID 更新一篇文章 */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">app</span><span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">&#x27;/articles/:id&#x27;</span><span class="token punctuation">,</span><span class="token plain"> adminAuth</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">req</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">Article</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span><span class="token plain">req</span><span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> status</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">doc </span><span class="token operator">===</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;文章不存在，请刷新后再试&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">for</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">prop </span><span class="token keyword">in</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      doc</span><span class="token punctuation">[</span><span class="token plain">prop</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> req</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">[</span><span class="token plain">prop</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    doc</span><span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      doc</span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> path</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;category&#x27;</span><span class="token punctuation">,</span><span class="token plain"> select</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;number&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">.</span><span class="token property-access">message</span><span class="token punctuation">,</span><span class="token plain"> err </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">relateCategory</span><span class="token punctuation">(</span><span class="token plain">doc</span><span class="token punctuation">.</span><span class="token property-access">category</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">return</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;更新成功&#x27;</span><span class="token punctuation">,</span><span class="token plain"> result</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> doc </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>常用数据库操作。</p><p>以 Koa 为例。</p><h2 id="获取列表"><a aria-hidden="true" href="#获取列表"><span class="icon icon-link"></span></a>获取列表</h2><p><strong>功能点：</strong></p><ul><li>分页<ul><li>页码：pageNo</li><li>每页条数：pageSize</li></ul></li><li>过滤查询</li><li>搜索<ul><li>模糊搜索</li><li>精准搜索</li></ul></li><li>排序<ul><li>正序</li><li>逆序</li></ul></li></ul><p><strong>示例：</strong></p><ul><li>默认首页，单页 10 项数据</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="let { pageSize = 10 } = ctx.query;
const pageNo = Math.max(ctx.query.pageNo * 1, 1) - 1;
pageSize = Math.max(pageSize * 1, 1);

// 键对应文档名，值表示排序方向，1 升序，-1 降序
const sort = ctx.query.sortDirections === &#x27;ASC&#x27; ? 1 : -1;

Article.find({}, [], { limit: pageSize, skip: pageNo * pageSize, sort: sort });

// or
Article.find()
  .limit(pageSize)
  .skip(pageNo * pageSize)
  .sort({
    username: 1,
    age: -1,
  });
" data-status="copy"></button><div class="token-line"><span class="token keyword">let</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> pageSize </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ctx</span><span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> pageNo </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">max</span><span class="token punctuation">(</span><span class="token plain">ctx</span><span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">pageNo</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">pageSize </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">max</span><span class="token punctuation">(</span><span class="token plain">pageSize </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 键对应文档名，值表示排序方向，1 升序，-1 降序</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> sort </span><span class="token operator">=</span><span class="token plain"> ctx</span><span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">sortDirections</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;ASC&#x27;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Article</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> limit</span><span class="token punctuation">:</span><span class="token plain"> pageSize</span><span class="token punctuation">,</span><span class="token plain"> skip</span><span class="token punctuation">:</span><span class="token plain"> pageNo </span><span class="token operator">*</span><span class="token plain"> pageSize</span><span class="token punctuation">,</span><span class="token plain"> sort</span><span class="token punctuation">:</span><span class="token plain"> sort </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// or</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Article</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">limit</span><span class="token punctuation">(</span><span class="token plain">pageSize</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span><span class="token plain">pageNo </span><span class="token operator">*</span><span class="token plain"> pageSize</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    username</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="获取某项"><a aria-hidden="true" href="#获取某项"><span class="icon icon-link"></span></a>获取某项</h2><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="User.findOne({}, [], function(err, res) {});
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>接收 id 为参数，id 可以是字符串也可以是 ObjectId 对象。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="User.findById(obj._id, function(err, res) {});
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span><span class="token plain">obj</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="符合条件的文档数"><a aria-hidden="true" href="#符合条件的文档数"><span class="icon icon-link"></span></a>符合条件的文档数</h2><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="User.count({ type: &#x27;jungle&#x27; }, function(err, count) {});
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">count</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;jungle&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> count</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="创建单个文档"><a aria-hidden="true" href="#创建单个文档"><span class="icon icon-link"></span></a>创建单个文档</h2><ul><li>参数鉴定</li><li>唯一性鉴定</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const { name } = ctx.request.body;
const repeatUser = await Article.findOne({ name });

if (repeatUser) {
  ctx.throw(409, &#x27;用户已存在!&#x27;);
}
Article.create({}, function() {});
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> name </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ctx</span><span class="token punctuation">.</span><span class="token property-access">request</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> repeatUser </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">await</span><span class="token plain"> </span><span class="token maybe-class-name">Article</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">repeatUser</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  ctx</span><span class="token punctuation">.</span><span class="token method function property-access">throw</span><span class="token punctuation">(</span><span class="token number">409</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;用户已存在!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Article</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="更新单个文档"><a aria-hidden="true" href="#更新单个文档"><span class="icon icon-link"></span></a>更新单个文档</h2><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Article.findByIdAndUpdate(ctx.params.id, ctx.request.body);
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Article</span><span class="token punctuation">.</span><span class="token method function property-access">findByIdAndUpdate</span><span class="token punctuation">(</span><span class="token plain">ctx</span><span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span><span class="token plain"> ctx</span><span class="token punctuation">.</span><span class="token property-access">request</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="删除单个文档"><a aria-hidden="true" href="#删除单个文档"><span class="icon icon-link"></span></a>删除单个文档</h2><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Article.findByIdAndRemove(ctx.params.id);
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Article</span><span class="token punctuation">.</span><span class="token method function property-access">findByIdAndRemove</span><span class="token punctuation">(</span><span class="token plain">ctx</span><span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook/edit/master/docs/server-application/database/mongodb/basic-usage.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/4/2020, 3:39:37 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/node-guidebook/umi.js"></script>
    <script src="/node-guidebook/docs__server-application__database__mongodb__basic-usage.md.js"></script>
  </body>
</html>
