<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/node-guidebook/umi.css" />
    <script>
      window.routerBase = "/node-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>查询 Queries</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//">Node Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/node-guidebook//overview">概览</a><a href="/node-guidebook//engine">引擎</a><a href="/node-guidebook//system">系统</a><a href="/node-guidebook//network">网络</a><a aria-current="page" class="active" href="/node-guidebook//server-application">服务端应用</a><a href="/node-guidebook//util-application">工具应用</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//"></a><h1>Node Guidebook</h1><p>Node 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/node-guidebook//overview">概览</a></li><li><a href="/node-guidebook//engine">引擎</a></li><li><a href="/node-guidebook//system">系统</a></li><li><a href="/node-guidebook//network">网络</a></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application">服务端应用</a></li><li><a href="/node-guidebook//util-application">工具应用</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/node-guidebook//server-application/architect">服务端架构设计</a><ul><li><a href="/node-guidebook//server-application/architect"><span>架构设计</span></a></li><li><a href="/node-guidebook//server-application/architect/test"><span>测试设计</span></a></li><li><a href="/node-guidebook//server-application/architect/logger"><span>日志设计</span></a></li><li><a href="/node-guidebook//server-application/architect/gateway"><span>网关设计</span></a></li><li><a href="/node-guidebook//server-application/architect/security"><span>安全设计</span></a></li><li><a href="/node-guidebook//server-application/architect/message-queue"><span>消息队列</span></a></li><li><a href="/node-guidebook//server-application/architect/database"><span>数据库</span></a></li></ul></li><li><a href="/node-guidebook//server-application/message-queue/kalfa">Kalfa</a></li><li><a href="/node-guidebook//server-application/message-queue/rabbitmq">RabbitMQ</a></li><li><a href="/node-guidebook//server-application/message-queue/redis">Redis</a></li><li><a href="/node-guidebook//server-application/server-framework/mysql">MySQL</a></li><li><a href="/node-guidebook//server-application/server-framework/express">Express</a><ul><li><a href="/node-guidebook//server-application/server-framework/express"><span>Express</span></a></li><li><a href="/node-guidebook//server-application/server-framework/express/principle"><span>实现原理</span></a></li></ul></li><li><a href="/node-guidebook//server-application/server-framework/koa">Koa</a><ul><li><a href="/node-guidebook//server-application/server-framework/koa"><span>Koa</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/source-code"><span>源码解析</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-router"><span>koa-router</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-jwt"><span>koa-jwt</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-helmet"><span>koa-helmet</span></a></li></ul></li><li><a href="/node-guidebook//server-application/server-framework/egg">Egg</a><ul><li><a href="/node-guidebook//server-application/server-framework/egg"><span>Egg</span></a></li><li><a href="/node-guidebook//server-application/server-framework/egg/architect"><span>框架架构</span></a></li><li><a href="/node-guidebook//server-application/server-framework/egg/core-feature"><span>核心功能</span></a></li></ul></li><li><a href="/node-guidebook//server-application/server-framework/mongodb">MongoDB</a><ul><li><a href="/node-guidebook//server-application/server-framework/mongodb/mongodb"><span>MongoDB</span></a></li><li><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage"><span>常用方法</span></a></li><li><a href="/node-guidebook//server-application/server-framework/mongodb/connections"><span>连接 Connections</span></a></li></ul></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application/database/mongodb">Database/mongodb</a><ul><li><a href="/node-guidebook//server-application/database/mongodb/aggregate"><span>聚合</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/documents"><span>文档 Documents</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/hooks"><span>钩子函数</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/middleware"><span>中间件 Middleware</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/model-api"><span>Model API</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/models"><span>模型 Models</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/plugins"><span>插件 Plugins</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/populate"><span>填充 Populate</span></a></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application/database/mongodb/queries"><span>查询 Queries</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/schema-types"><span>模式类型 SchemaTypes</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/schemas"><span>模式 Schema</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/subdocuments"><span>子文档 Subdocuments</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/validation"><span>验证 Validation</span></a></li></ul></li><li><a href="/node-guidebook//server-application/pm2">Pm2</a></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="collation" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/queries#collation"><span>collation</span></a></li><li title="引用其它文档" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/queries#引用其它文档"><span>引用其它文档</span></a></li><li title="Streaming" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/queries#streaming"><span>Streaming</span></a></li><li title="存在创建修改器" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/queries#存在创建修改器"><span>存在创建修改器</span></a></li><li title="存在删除修改器" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/queries#存在删除修改器"><span>存在删除修改器</span></a></li><li title="数组修改器" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/queries#数组修改器"><span>数组修改器</span></a></li><li title="条件查询" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/queries#条件查询"><span>条件查询</span></a></li><li title="类型查询" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/queries#类型查询"><span>类型查询</span></a></li><li title="正则表达式" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/queries#正则表达式"><span>正则表达式</span></a></li><li title="查询数组" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/queries#查询数组"><span>查询数组</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="查询-queries"><a aria-hidden="true" href="#查询-queries"><span class="icon icon-link"></span></a>查询 Queries</h1><ul><li>查询方法<ul><li>find</li><li>findById</li><li>findOne</li><li>count</li><li>其它关联<ul><li>findOneAndUpdate</li><li>findOneAndDelete</li></ul></li></ul></li></ul><h2 id="collation"><a aria-hidden="true" href="#collation"><span class="icon icon-link"></span></a>collation</h2><p>中文排序</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="await ctx.model.User.find({}, { username: 1, _id: 0 })
  .sort({ username: 1 })
  .collation({ locale: &#x27;zh&#x27; });
" data-status="copy"></button><div class="token-line"><span class="token keyword">await</span><span class="token plain"> ctx</span><span class="token punctuation">.</span><span class="token property-access">model</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> username</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> _id</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> username</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">collation</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> locale</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;zh&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><hr/><p>Model 的多个静态辅助方法都可以查询文档。</p><p>Model 的方法中包含查询条件参数的（<code>find</code>、<code>findById</code>、<code>count</code>、<code>update</code>）都可以按以下两种方式执行：</p><ul><li>传入 <code>callback</code> 参数，操作会被立即执行，查询结果被传给回调函数（callback）</li><li>不传 <code>callback</code> 参数，Query 的一个实例（一个 query 对象）被返回，这个 query 提供了构建查询器的特殊接口</li></ul><p>Query 实例有一个 <code>.then()</code> 函数，用法类似 Promise。</p><p>如果执行查询时传入 <code>callback</code> 参数，就需要 JSON 文档的格式指定查询条件。JSON 文档的语法跟 <a href="http://docs.mongodb.org/manual/tutorial/query-documents/" target="_blank" rel="noopener noreferrer">MongoDB Shell<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一致。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const Person = mongoose.model(&#x27;Person&#x27;, personSchema);

// 查询每个 last name 是 &#x27;Ghost&#x27; 的 person， select `name` 和 `occupation` 字段
Person.findOne({ &#x27;name.last&#x27;: &#x27;Ghost&#x27; }, &#x27;name occupation&#x27;, function(err, person) {
  if (err) return handleError(err);
  // Prints &quot;Space Ghost is a talk show host&quot;.
  console.log(&#x27;%s %s is a %s.&#x27;, person.name.first, person.name.last, person.occupation);
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Person</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">,</span><span class="token plain"> personSchema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 查询每个 last name 是 &#x27;Ghost&#x27; 的 person， select `name` 和 `occupation` 字段</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Person</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&#x27;name.last&#x27;</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Ghost&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;name occupation&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> person</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Prints &quot;Space Ghost is a talk show host&quot;.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;%s %s is a %s.&#x27;</span><span class="token punctuation">,</span><span class="token plain"> person</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">.</span><span class="token property-access">first</span><span class="token punctuation">,</span><span class="token plain"> person</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">.</span><span class="token property-access">last</span><span class="token punctuation">,</span><span class="token plain"> person</span><span class="token punctuation">.</span><span class="token property-access">occupation</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>上例中查询被立即执行，查询结果被传给回调函数。Mongoose 中所有的回调函数都使用 <code>callback(error, result)</code> 这种模式。如果查询时发生错误，<code>error</code> 参数即是错误文档，<code>result</code> 参数会是 <code>null</code>。如果查询成功，<code>error</code> 参数是 <code>null</code>，<code>result</code> 即是查询的结果。</p><p>Mongoose 中每一处查询，被传入的回调函数都遵循 <code>callback(error, result)</code> 这种模式。查询结果的格式取决于做什么操作：<code>findOne()</code> 是单个文档（有可能是 <code>null</code>），<code>find()</code> 是文档列表， <code>count()</code> 是文档数量，<code>update()</code> 是被修改的文档数量。 Models API 文档中有详细描述被传给回调函数的值。</p><p>下面来看不传入 callback 这个参数会怎样：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 查询每个 last name 是 &#x27;Ghost&#x27; 的 person
var query = Person.findOne({ &#x27;name.last&#x27;: &#x27;Ghost&#x27; });

// select `name` 和 `occupation` 字段
query.select(&#x27;name occupation&#x27;);

// 然后执行查询
query.exec(function(err, person) {
  if (err) return handleError(err);
  // Prints &quot;Space Ghost is a talk show host.&quot;
  console.log(&#x27;%s %s is a %s.&#x27;, person.name.first, person.name.last, person.occupation);
});
" data-status="copy"></button><div class="token-line"><span class="token comment">// 查询每个 last name 是 &#x27;Ghost&#x27; 的 person</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">var</span><span class="token plain"> query </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Person</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string">&#x27;name.last&#x27;</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Ghost&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// select `name` 和 `occupation` 字段</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">query</span><span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token string">&#x27;name occupation&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 然后执行查询</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">query</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> person</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Prints &quot;Space Ghost is a talk show host.&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;%s %s is a %s.&#x27;</span><span class="token punctuation">,</span><span class="token plain"> person</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">.</span><span class="token property-access">first</span><span class="token punctuation">,</span><span class="token plain"> person</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">.</span><span class="token property-access">last</span><span class="token punctuation">,</span><span class="token plain"> person</span><span class="token punctuation">.</span><span class="token property-access">occupation</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>以上代码中，query 是个 Query 类型的变量。 Query 能够用链式语法构建查询器，无需指定 JSON 对象。 下面 2 个示例等效。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// With a JSON doc
Person.find({
  occupation: /host/,
  &#x27;name.last&#x27;: &#x27;Ghost&#x27;,
  age: { $gt: 17, $lt: 66 },
  likes: { $in: [&#x27;vaporizing&#x27;, &#x27;talking&#x27;] },
})
  .limit(10)
  .sort({ occupation: -1 })
  .select({ name: 1, occupation: 1 })
  .exec(callback);

// Using query builder
Person.find({ occupation: /host/ })
  .where(&#x27;name.last&#x27;)
  .equals(&#x27;Ghost&#x27;)
  .where(&#x27;age&#x27;)
  .gt(17)
  .lt(66)
  .where(&#x27;likes&#x27;)
  .in([&#x27;vaporizing&#x27;, &#x27;talking&#x27;])
  .limit(10)
  .sort(&#x27;-occupation&#x27;)
  .select(&#x27;name occupation&#x27;)
  .exec(callback);
" data-status="copy"></button><div class="token-line"><span class="token comment">// With a JSON doc</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Person</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  occupation</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/host/</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;name.last&#x27;</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Ghost&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> $gt</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">17</span><span class="token punctuation">,</span><span class="token plain"> $lt</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">66</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  likes</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> $</span><span class="token keyword">in</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&#x27;vaporizing&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;talking&#x27;</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> occupation</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> occupation</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token plain">callback</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// Using query builder</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Person</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> occupation</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/host/</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">where</span><span class="token punctuation">(</span><span class="token string">&#x27;name.last&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">equals</span><span class="token punctuation">(</span><span class="token string">&#x27;Ghost&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">where</span><span class="token punctuation">(</span><span class="token string">&#x27;age&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">gt</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">lt</span><span class="token punctuation">(</span><span class="token number">66</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">where</span><span class="token punctuation">(</span><span class="token string">&#x27;likes&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">in</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#x27;vaporizing&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;talking&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token string">&#x27;-occupation&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token string">&#x27;name occupation&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token plain">callback</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="引用其它文档"><a aria-hidden="true" href="#引用其它文档"><span class="icon icon-link"></span></a>引用其它文档</h3><p>MongoDB 没有表连接，但引用其它集合的文档有时也会需要。Population 即为此而生。</p><h3 id="streaming"><a aria-hidden="true" href="#streaming"><span class="icon icon-link"></span></a>Streaming</h3><p>你可以流式（stream）处理 MongoDB 的查询结果，需要调用 <code>Query.cursor()</code> 函数获得 QueryCursor 的实例。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const cursor = Person.find({ occupation: /host/ }).cursor();

cursor.on(&#x27;data&#x27;, function(doc) {
  // Called once for every document
});

cursor.on(&#x27;close&#x27;, function() {
  // Called when done
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> cursor </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Person</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> occupation</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/host/</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">cursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">cursor</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;data&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Called once for every document</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">cursor</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;close&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// Called when done</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h1 id="高级查询"><a aria-hidden="true" href="#高级查询"><span class="icon icon-link"></span></a>高级查询</h1><p><code>$inc</code> 增减修改器，只对数字有效。下面的实例：找到 <code>age = 22</code> 的文档,修改文档的 age 值自增 1</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.update(
  {
    age: 22,
  },
  {
    $inc: {
      age: 1,
    },
  }
);
// 执行后：age = 23
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">22</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $inc</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 执行后：age = 23</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="存在创建修改器"><a aria-hidden="true" href="#存在创建修改器"><span class="icon icon-link"></span></a>存在创建修改器</h3><p><code>$set</code> 指定一个键的值，这个键不存在就创建它。可以是任何 MondoDB 支持的类型。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.update(
  {
    age: 22,
  },
  {
    $set: {
      age: &#x27;haha&#x27;,
    },
  }
);
// 执行后: age = &#x27;haha&#x27;
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">22</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $</span><span class="token keyword">set</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;haha&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 执行后: age = &#x27;haha&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="存在删除修改器"><a aria-hidden="true" href="#存在删除修改器"><span class="icon icon-link"></span></a>存在删除修改器</h3><p><code>$unset</code> 同上取反，删除一个键。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.update(
  {
    age: 22,
  },
  {
    $unset: {
      age: &#x27;haha&#x27;,
    },
  }
);
// 执行后: age 键不存在
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">22</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $unset</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;haha&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 执行后: age 键不存在</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="数组修改器"><a aria-hidden="true" href="#数组修改器"><span class="icon icon-link"></span></a>数组修改器</h2><p><code>$push</code> 给一个键 push 一个数组成员,键不存在会创建</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.update(
  {
    age: 22,
  },
  {
    $push: {
      array: 10,
    },
  }
);
// 执行后: 增加一个 array 键，类型为数组, 有一个成员 10
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">22</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $push</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      array</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 执行后: 增加一个 array 键，类型为数组, 有一个成员 10</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>$addToSet</code> 向数组中添加一个元素，如果存在就不添加</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.update(
  {
    age: 22,
  },
  {
    $addToSet: {
      array: 10,
    },
  }
);
// 执行后: array 中有 10 所以不会添加
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">22</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $addToSet</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      array</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 执行后: array 中有 10 所以不会添加</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>$each</code> 遍历数组, 和 <code>$push</code> 修改器配合可以插入多个值</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.update(
  {
    age: 22,
  },
  {
    $push: {
      array: {
        $each: [1, 2, 3, 4, 5],
      },
    },
  }
);
// 执行后: array : [10,1,2,3,4,5]
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">22</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $push</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      array</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        $each</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 执行后: array : [10,1,2,3,4,5]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>$pop</code> 向数组中尾部删除一个元素</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.update(
  {
    age: 22,
  },
  {
    $pop: {
      array: 1,
    },
  }
);
// 执行后: array : [10,1,2,3,4]  tips: 将1改成-1可以删除数组首部元素
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">22</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $pop</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      array</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 执行后: array : [10,1,2,3,4]  tips: 将1改成-1可以删除数组首部元素</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>$pull</code> 向数组中删除指定元素</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.update(
  {
    age: 22,
  },
  {
    $pull: {
      array: 10,
    },
  }
);
// 执行后: array : [1,2,3,4]  匹配到 array 中的 10 后将其删除
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">22</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $pull</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      array</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 执行后: array : [1,2,3,4]  匹配到 array 中的 10 后将其删除</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="条件查询"><a aria-hidden="true" href="#条件查询"><span class="icon icon-link"></span></a>条件查询</h2><ul><li><code>$lt</code> 小于</li><li><code>$lte</code> 小于等于</li><li><code>$gt</code> 大于</li><li><code>$gte</code> 大于等于</li><li><code>$ne</code> 不等于</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find({
  age: {
    $gte: 18,
    $lte: 30,
  },
});
// 查询 age 大于等于 18 并小于等于 30 的文档
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $gte</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">18</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $lte</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">30</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 查询 age 大于等于 18 并小于等于 30 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>或查询 OR:</p><ul><li><code>$in</code> 一个键对应多个值</li><li><code>$nin</code> 同上取反, 一个键不对应指定值</li><li><code>$or</code> 多个条件匹配, 可以嵌套 <code>$in</code> 使用</li><li><code>$not</code> 同上取反, 查询与特定模式不匹配的文档</li></ul><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find({
  age: {
    $in: [20, 21, 22, &#x27;haha&#x27;],
  },
});
// 查询 age 等于 20 或 21 或 22 或 &#x27;haha&#x27; 的文档
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $</span><span class="token keyword">in</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">21</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">22</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;haha&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 查询 age 等于 20 或 21 或 22 或 &#x27;haha&#x27; 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find({
  $or: [
    {
      age: 18,
    },
    {
      name: &#x27;xueyou&#x27;,
    },
  ],
});
// 查询 age 等于 18 或 name 等于 &#x27;xueyou&#x27; 的文档
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  $or</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">18</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;xueyou&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 查询 age 等于 18 或 name 等于 &#x27;xueyou&#x27; 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="类型查询"><a aria-hidden="true" href="#类型查询"><span class="icon icon-link"></span></a>类型查询</h2><p><code>null</code> 能匹配自身和不存在的值，想要匹配键的值 为 <code>null</code>，就要通过 <code>$exists</code> 条件判定键值已经存在。</p><p><code>$exists</code> (表示是否存在的意思)</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 查询 age 值为 null 的文档
Model.find(
  {&#x27;age&#x27;: {
    $in: [null],
    exists: true,
  }}
);
" data-status="copy"></button><div class="token-line"><span class="token comment">// 查询 age 值为 null 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token string">&#x27;age&#x27;</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $</span><span class="token keyword">in</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token keyword null nil">null</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    exists</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 查询所有存在 name 属性的文档
Model.find(
  {
    name: { $exists: true },
  },
  function(error, res) {}
);
" data-status="copy"></button><div class="token-line"><span class="token comment">// 查询所有存在 name 属性的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> $exists</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 查询所有不存在 telephone 属性的文档
Model.find(
  {
    telephone: {
      $exists: false,
    },
  },
  function(error, res) {
    // do something
  }
);
" data-status="copy"></button><div class="token-line"><span class="token comment">// 查询所有不存在 telephone 属性的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    telephone</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      $exists</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// do something</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="正则表达式"><a aria-hidden="true" href="#正则表达式"><span class="icon icon-link"></span></a>正则表达式</h2><p>MongoDb 使用 Prel 兼容的正则表达式库来匹配正则表达式</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find({
  name: /joe/i,
});
// 查询 name 为 joe 的文档, 并忽略大小写
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/joe/i</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 查询 name 为 joe 的文档, 并忽略大小写</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find({
  name: /joe?/i,
});
// 查询匹配各种大小写组合
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/joe?/i</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 查询匹配各种大小写组合</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="查询数组"><a aria-hidden="true" href="#查询数组"><span class="icon icon-link"></span></a>查询数组</h2><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find({
  array: 10,
});
//查询 array（数组类型）键中有 10 的文档, array : [1,2,3,4,5,10] 会匹配到
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  array</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//查询 array（数组类型）键中有 10 的文档, array : [1,2,3,4,5,10] 会匹配到</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find({
  &#x27;array[5]&#x27;: 10,
});
// 查询 array（数组类型）键中下标 5 对应的值是 10, array : [1,2,3,4,5,10] 会匹配到
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token string">&#x27;array[5]&#x27;</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 查询 array（数组类型）键中下标 5 对应的值是 10, array : [1,2,3,4,5,10] 会匹配到</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>$all</code> 匹配数组中多个元素</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find({
  array: [5, 10],
});
//查询 匹配 array 数组中 既有 5 又有 10 的文档
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  array</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//查询 匹配 array 数组中 既有 5 又有 10 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>$size</code> 匹配数组长度</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find({
  array: {
    $size: 3,
  },
});
//查询 匹配 array 数组长度为 3 的文档
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  array</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $size</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">3</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//查询 匹配 array 数组长度为 3 的文档</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><code>$slice</code> 查询子集合返回</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find({
  array: {
    $skice: 10,
  },
});
//查询 匹配 array 数组的前 10 个元素
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  array</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $skice</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//查询 匹配 array 数组的前 10 个元素</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Model.find({
  array: {
    $skice: [5, 10],
  },
});
//查询 匹配 array 数组的第 5 个到第 10 个元素
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Model</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  array</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    $skice</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">//查询 匹配 array 数组的第 5 个到第 10 个元素</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook/edit/master/docs/server-application/database/mongodb/queries.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/4/2020, 3:39:37 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/node-guidebook/umi.js"></script>
    <script src="/node-guidebook/docs__server-application__database__mongodb__queries.md.js"></script>
  </body>
</html>
