<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/node-guidebook/umi.css" />
    <script>
      window.routerBase = "/node-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>填充 Populate</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//">Node Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/node-guidebook//overview">概览</a><a href="/node-guidebook//engine">引擎</a><a href="/node-guidebook//system">系统</a><a href="/node-guidebook//network">网络</a><a aria-current="page" class="active" href="/node-guidebook//server-application">服务端应用</a><a href="/node-guidebook//util-application">工具应用</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//"></a><h1>Node Guidebook</h1><p>Node 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/node-guidebook//overview">概览</a></li><li><a href="/node-guidebook//engine">引擎</a></li><li><a href="/node-guidebook//system">系统</a></li><li><a href="/node-guidebook//network">网络</a></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application">服务端应用</a></li><li><a href="/node-guidebook//util-application">工具应用</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/node-guidebook//server-application/architect">服务端架构设计</a><ul><li><a href="/node-guidebook//server-application/architect"><span>架构设计</span></a></li><li><a href="/node-guidebook//server-application/architect/test"><span>测试设计</span></a></li><li><a href="/node-guidebook//server-application/architect/logger"><span>日志设计</span></a></li><li><a href="/node-guidebook//server-application/architect/gateway"><span>网关设计</span></a></li><li><a href="/node-guidebook//server-application/architect/security"><span>安全设计</span></a></li><li><a href="/node-guidebook//server-application/architect/message-queue"><span>消息队列</span></a></li><li><a href="/node-guidebook//server-application/architect/database"><span>数据库</span></a></li></ul></li><li><a href="/node-guidebook//server-application/message-queue/kalfa">Kalfa</a></li><li><a href="/node-guidebook//server-application/message-queue/rabbitmq">RabbitMQ</a></li><li><a href="/node-guidebook//server-application/message-queue/redis">Redis</a></li><li><a href="/node-guidebook//server-application/server-framework/mysql">MySQL</a></li><li><a href="/node-guidebook//server-application/server-framework/express">Express</a><ul><li><a href="/node-guidebook//server-application/server-framework/express"><span>Express</span></a></li><li><a href="/node-guidebook//server-application/server-framework/express/principle"><span>实现原理</span></a></li></ul></li><li><a href="/node-guidebook//server-application/server-framework/koa">Koa</a><ul><li><a href="/node-guidebook//server-application/server-framework/koa"><span>Koa</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/source-code"><span>源码解析</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-router"><span>koa-router</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-jwt"><span>koa-jwt</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-helmet"><span>koa-helmet</span></a></li></ul></li><li><a href="/node-guidebook//server-application/server-framework/egg">Egg</a><ul><li><a href="/node-guidebook//server-application/server-framework/egg"><span>Egg</span></a></li><li><a href="/node-guidebook//server-application/server-framework/egg/architect"><span>框架架构</span></a></li><li><a href="/node-guidebook//server-application/server-framework/egg/core-feature"><span>核心功能</span></a></li></ul></li><li><a href="/node-guidebook//server-application/server-framework/mongodb">MongoDB</a><ul><li><a href="/node-guidebook//server-application/server-framework/mongodb/mongodb"><span>MongoDB</span></a></li><li><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage"><span>常用方法</span></a></li><li><a href="/node-guidebook//server-application/server-framework/mongodb/connections"><span>连接 Connections</span></a></li></ul></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application/database/mongodb">Database/mongodb</a><ul><li><a href="/node-guidebook//server-application/database/mongodb/aggregate"><span>聚合</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/documents"><span>文档 Documents</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/hooks"><span>钩子函数</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/middleware"><span>中间件 Middleware</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/model-api"><span>Model API</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/models"><span>模型 Models</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/plugins"><span>插件 Plugins</span></a></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application/database/mongodb/populate"><span>填充 Populate</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/queries"><span>查询 Queries</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/schema-types"><span>模式类型 SchemaTypes</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/schemas"><span>模式 Schema</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/subdocuments"><span>子文档 Subdocuments</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/validation"><span>验证 Validation</span></a></li></ul></li><li><a href="/node-guidebook//server-application/pm2">Pm2</a></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="保存 refs" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/populate#保存-refs"><span>保存 refs</span></a></li><li title="Population" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/populate#population"><span>Population</span></a></li><li title="设置被填充字段" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/populate#设置被填充字段"><span>设置被填充字段</span></a></li><li title="字段选择" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/populate#字段选择"><span>字段选择</span></a></li><li title="填充多个字段" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/populate#填充多个字段"><span>填充多个字段</span></a></li><li title="Query 条件与其它选项" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/populate#query-条件与其它选项"><span>Query 条件与其它选项</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="填充-populate"><a aria-hidden="true" href="#填充-populate"><span class="icon icon-link"></span></a>填充 Populate</h1><p>Populate 可以自动替换 document 中的指定字段，替换内容从其它 collection 获取。我们可以填充单个或多个 document、单个或多个纯对象，甚至是 query 返回的一切对象。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const mongoose = require(&#x27;mongoose&#x27;);
const Schema = mongoose.Schema;

const personSchema = Schema({
  _id: Schema.Types.ObjectId,
  name: String,
  age: Number,
  stories: [{ type: Schema.Types.ObjectId, ref: &#x27;Story&#x27; }],
});

const storySchema = Schema({
  author: { type: Schema.Types.ObjectId, ref: &#x27;Person&#x27; },
  title: String,
  fans: [{ type: Schema.Types.ObjectId, ref: &#x27;Person&#x27; }],
});

const Story = mongoose.model(&#x27;Story&#x27;, storySchema);
const Person = mongoose.model(&#x27;Person&#x27;, personSchema);
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> mongoose </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mongoose&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Schema</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> personSchema </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function maybe-class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  _id</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Types</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ObjectId</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Number</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  stories</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Types</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ObjectId</span><span class="token punctuation">,</span><span class="token plain"> ref</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Story&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> storySchema </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function maybe-class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  author</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Types</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ObjectId</span><span class="token punctuation">,</span><span class="token plain"> ref</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Person&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  title</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  fans</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Types</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ObjectId</span><span class="token punctuation">,</span><span class="token plain"> ref</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Person&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Story</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Story&#x27;</span><span class="token punctuation">,</span><span class="token plain"> storySchema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Person</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">,</span><span class="token plain"> personSchema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>现在我们创建了两个 Model。<code>Person</code> model 的 <code>stories</code> 字段设为 <code>ObjectId</code> 数组。<code>ref</code> 选项告诉 Mongoose 在填充的时候使用哪个 model，本例中为 <code>Story</code> model。所有储存在此的 <code>_id</code> 都必须是 <code>Story</code> model 中 document <code>_id</code>。</p><h2 id="保存-refs"><a aria-hidden="true" href="#保存-refs"><span class="icon icon-link"></span></a>保存 refs</h2><p>保存 refs 与保存普通属性一样，把 <code>_id</code> 的值赋给它就好了：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const author = new Person({
  _id: new mongoose.Types.ObjectId(),
  name: &#x27;Ian Fleming&#x27;,
  age: 50,
});

author.save(function(err) {
  if (err) return handleError(err);

  const story1 = new Story({
    title: &#x27;Casino Royale&#x27;,
    author: author._id,
    // assign the _id from the person
  });

  story1.save(function(err) {
    if (err) return hanleError(err);
    // thats it!
  });
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> author </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  _id</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">mongoose</span><span class="token class-name punctuation">.</span><span class="token class-name">Types</span><span class="token class-name punctuation">.</span><span class="token class-name">ObjectId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Ian Fleming&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">50</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">author</span><span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> story1 </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Story</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    title</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Casino Royale&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    author</span><span class="token punctuation">:</span><span class="token plain"> author</span><span class="token punctuation">.</span><span class="token property-access">_id</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// assign the _id from the person</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">  story1</span><span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">hanleError</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// thats it!</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="population"><a aria-hidden="true" href="#population"><span class="icon icon-link"></span></a>Population</h2><p>至此我们做的东西还是跟平常差不多，只是创建了 <code>Person</code> 和 <code>Story</code>。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Story.findOne({ title: &#x27;Casino Royale&#x27; })
  .populate(&#x27;author&#x27;)
  .exec(function(err, story) {
    if (err) return handleError(error);
    console.log(&#x27;The author is %s&#x27;, story.author.name);
    // prints &quot;The author is Ian Fleming&quot;
  });
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Story</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> title</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Casino Royale&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token string">&#x27;author&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> story</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;The author is %s&#x27;</span><span class="token punctuation">,</span><span class="token plain"> story</span><span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// prints &quot;The author is Ian Fleming&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>被填充的字段已经不是原来的 <code>_id</code>，而是被指定的 document 代替，这个 document 由另一条 query 从数据库返回。<code>refs</code> 数组的远离也与此相似。对 query 对象调用 populate 方法，就能返回装载对应 <code>_id</code> 的 document 数组。</p><h2 id="设置被填充字段"><a aria-hidden="true" href="#设置被填充字段"><span class="icon icon-link"></span></a>设置被填充字段</h2><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Story.findOne({ title: &#x27;Casino Royale&#x27; }, function(error, story) {
  if (error) {
    return handleError(error);
  }
  story.author = author;
  console.log(story.author.name); // prints &#x27;Ian Fleming&#x27;
});
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Story</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> title</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;Casino Royale&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token parameter punctuation">,</span><span class="token parameter"> story</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  story</span><span class="token punctuation">.</span><span class="token property-access">author</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> author</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">story</span><span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// prints &#x27;Ian Fleming&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="字段选择"><a aria-hidden="true" href="#字段选择"><span class="icon icon-link"></span></a>字段选择</h2><p>如果我们只需要填充的 document 其中一部分字段怎么办。第二参数传入 <code>find name syntax</code> 就能实现。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Story.
  .findOne({ title: /casino royale/i })
  .populate(&#x27;author&#x27;, &#x27;name&#x27;) // only return the Persons name
  .exec(function (err, story) {
    if (err) return handleError(err);

    console.log(&#x27;The author is %s&#x27;, story.author.name);
    // prints &quot;The author is Ian Fleming&quot;

    console.log(&#x27;The authors age is %s&#x27;, story.author.age);
    // prints &quot;The authors age is null&#x27;
  });
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Story</span><span class="token punctuation">.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> title</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token regex">/casino royale/i</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token string">&#x27;author&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token comment">// only return the Persons name</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> story</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;The author is %s&#x27;</span><span class="token punctuation">,</span><span class="token plain"> story</span><span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// prints &quot;The author is Ian Fleming&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">&#x27;The authors age is %s&#x27;</span><span class="token punctuation">,</span><span class="token plain"> story</span><span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">age</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// prints &quot;The authors age is null&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="填充多个字段"><a aria-hidden="true" href="#填充多个字段"><span class="icon icon-link"></span></a>填充多个字段</h2><p>一次填充多个字段。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Story
  .find(...)
  .populate(&#x27;fans&#x27;)
  .populate(&#x27;author&#x27;)
  .exec()
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Story</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token string">&#x27;fans&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token string">&#x27;author&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>如果对同一路径 <code>populate()</code> 两次，只有最后一次生效。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 第二个 `populate()` 覆盖了第一个，因为它们都填充 fans
Story.find()
  .populate({ path: &#x27;fans&#x27;, select: &#x27;name&#x27; })
  .populate({ path: &#x27;fans&#x27;, select: &#x27;email&#x27; });
// The above is equivalent to:

Story.find().populate({ path: &#x27;fans&#x27;, select: &#x27;email&#x27; });
" data-status="copy"></button><div class="token-line"><span class="token comment">// 第二个 `populate()` 覆盖了第一个，因为它们都填充 fans</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Story</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> path</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;fans&#x27;</span><span class="token punctuation">,</span><span class="token plain"> select</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;name&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> path</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;fans&#x27;</span><span class="token punctuation">,</span><span class="token plain"> select</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;email&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// The above is equivalent to:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Story</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> path</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;fans&#x27;</span><span class="token punctuation">,</span><span class="token plain"> select</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;email&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="query-条件与其它选项"><a aria-hidden="true" href="#query-条件与其它选项"><span class="icon icon-link"></span></a>Query 条件与其它选项</h2><p>如果要根据年龄来填充，只填充 name，并且，只返回最多 5 个数据。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Story.
  find(...).
  populate({
    path: &#x27;fans&#x27;,
    match: { age: { $gte: 21 }},
    // Explicitly exclude `_id`, see http://bit.ly/2aEfTdB
    select: &#x27;name -_id&#x27;,
    options: { limit: 5 }
  }).
  exec();
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Story</span><span class="token punctuation">.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token spread operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    path</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;fans&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    match</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> age</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> $gte</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">21</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// Explicitly exclude `_id`, see http://bit.ly/2aEfTdB</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    select</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;name -_id&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    options</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> limit</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">5</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><a href="https://segmentfault.com/a/1190000002727265" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000002727265<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><ol><li>Query#populate</li><li>Model#populate</li><li>Document#populate</li></ol></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook/edit/master/docs/server-application/database/mongodb/populate.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/4/2020, 3:39:37 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/node-guidebook/umi.js"></script>
    <script src="/node-guidebook/docs__server-application__database__mongodb__populate.md.js"></script>
  </body>
</html>
