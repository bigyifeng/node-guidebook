<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
    <link rel="stylesheet" href="/node-guidebook/umi.css" />
    <script>
      window.routerBase = "/node-guidebook/";
    </script>
    <script>
      //! umi version: 3.2.19
    </script>
    <title>模型 Models</title>
  
</head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//">Node Guidebook</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><a href="/node-guidebook//overview">概览</a><a href="/node-guidebook//engine">引擎</a><a href="/node-guidebook//system">系统</a><a href="/node-guidebook//network">网络</a><a aria-current="page" class="active" href="/node-guidebook//server-application">服务端应用</a><a href="/node-guidebook//util-application">工具应用</a><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;http://img.mrsingsing.com/node-guidebook-favicon.svg&#x27;)" href="/node-guidebook//"></a><h1>Node Guidebook</h1><p>Node 完全知识体系</p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/node-guidebook//overview">概览</a></li><li><a href="/node-guidebook//engine">引擎</a></li><li><a href="/node-guidebook//system">系统</a></li><li><a href="/node-guidebook//network">网络</a></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application">服务端应用</a></li><li><a href="/node-guidebook//util-application">工具应用</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a href="/node-guidebook//server-application/architect">服务端架构设计</a><ul><li><a href="/node-guidebook//server-application/architect"><span>架构设计</span></a></li><li><a href="/node-guidebook//server-application/architect/test"><span>测试设计</span></a></li><li><a href="/node-guidebook//server-application/architect/logger"><span>日志设计</span></a></li><li><a href="/node-guidebook//server-application/architect/gateway"><span>网关设计</span></a></li><li><a href="/node-guidebook//server-application/architect/security"><span>安全设计</span></a></li><li><a href="/node-guidebook//server-application/architect/message-queue"><span>消息队列</span></a></li><li><a href="/node-guidebook//server-application/architect/database"><span>数据库</span></a></li></ul></li><li><a href="/node-guidebook//server-application/message-queue/kalfa">Kalfa</a></li><li><a href="/node-guidebook//server-application/message-queue/rabbitmq">RabbitMQ</a></li><li><a href="/node-guidebook//server-application/message-queue/redis">Redis</a></li><li><a href="/node-guidebook//server-application/server-framework/mysql">MySQL</a></li><li><a href="/node-guidebook//server-application/server-framework/express">Express</a><ul><li><a href="/node-guidebook//server-application/server-framework/express"><span>Express</span></a></li><li><a href="/node-guidebook//server-application/server-framework/express/principle"><span>实现原理</span></a></li></ul></li><li><a href="/node-guidebook//server-application/server-framework/koa">Koa</a><ul><li><a href="/node-guidebook//server-application/server-framework/koa"><span>Koa</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/source-code"><span>源码解析</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-router"><span>koa-router</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-jwt"><span>koa-jwt</span></a></li><li><a href="/node-guidebook//server-application/server-framework/koa/koa-helmet"><span>koa-helmet</span></a></li></ul></li><li><a href="/node-guidebook//server-application/server-framework/egg">Egg</a><ul><li><a href="/node-guidebook//server-application/server-framework/egg"><span>Egg</span></a></li><li><a href="/node-guidebook//server-application/server-framework/egg/architect"><span>框架架构</span></a></li><li><a href="/node-guidebook//server-application/server-framework/egg/core-feature"><span>核心功能</span></a></li></ul></li><li><a href="/node-guidebook//server-application/server-framework/mongodb">MongoDB</a><ul><li><a href="/node-guidebook//server-application/server-framework/mongodb/mongodb"><span>MongoDB</span></a></li><li><a href="/node-guidebook//server-application/server-framework/mongodb/basic-usage"><span>常用方法</span></a></li><li><a href="/node-guidebook//server-application/server-framework/mongodb/connections"><span>连接 Connections</span></a></li></ul></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application/database/mongodb">Database/mongodb</a><ul><li><a href="/node-guidebook//server-application/database/mongodb/aggregate"><span>聚合</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/documents"><span>文档 Documents</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/hooks"><span>钩子函数</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/middleware"><span>中间件 Middleware</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/model-api"><span>Model API</span></a></li><li><a aria-current="page" class="active" href="/node-guidebook//server-application/database/mongodb/models"><span>模型 Models</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/plugins"><span>插件 Plugins</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/populate"><span>填充 Populate</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/queries"><span>查询 Queries</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/schema-types"><span>模式类型 SchemaTypes</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/schemas"><span>模式 Schema</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/subdocuments"><span>子文档 Subdocuments</span></a></li><li><a href="/node-guidebook//server-application/database/mongodb/validation"><span>验证 Validation</span></a></li></ul></li><li><a href="/node-guidebook//server-application/pm2">Pm2</a></li></ul></div></div><ul class="__dumi-default-layout-toc" role="slug-list"><li title="定义模型" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/models#定义模型"><span>定义模型</span></a></li><li title="model" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/models#model"><span>model</span></a></li><li title="文档保存 save" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/models#文档保存-save"><span>文档保存 save</span></a></li><li title="自定义方法" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/models#自定义方法"><span>自定义方法</span></a></li><li title="实例方法 methods" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/models#实例方法-methods"><span>实例方法 methods</span></a></li><li title="静态方法 statics" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/models#静态方法-statics"><span>静态方法 statics</span></a></li><li title="查询方法" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/models#查询方法"><span>查询方法</span></a></li><li title="Model" data-depth="2" class=""><a href="/node-guidebook//server-application/database/mongodb/models#model-1"><span>Model</span></a></li><li title="构造 documents" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/models#构造-documents"><span>构造 documents</span></a></li><li title="新增" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/models#新增"><span>新增</span></a></li><li title="查询" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/models#查询"><span>查询</span></a></li><li title="删除" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/models#删除"><span>删除</span></a></li><li title="更多" data-depth="3" class=""><a href="/node-guidebook//server-application/database/mongodb/models#更多"><span>更多</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="模型-models"><a aria-hidden="true" href="#模型-models"><span class="icon icon-link"></span></a>模型 Models</h1><h2 id="定义模型"><a aria-hidden="true" href="#定义模型"><span class="icon icon-link"></span></a>定义模型</h2><h3 id="model"><a aria-hidden="true" href="#model"><span class="icon icon-link"></span></a>model</h3><p>定义数据库模型：</p><p>model 里面的第一个参数，要注意：</p><ol><li>首字母大写</li><li>要和数据库表（集合）名称对应</li></ol><p>第一个参数是结构对象，每个键就是一个字段，你可以定义类型/默认值/验证/索引等。 第二个参数是可选的（默认是取 <code>model</code> 的第一个参数加 <code>s</code>），用来自定义 Collection 的名称。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const mongoose = require(&#x27;mongoose&#x27;);
const { Schema } = mongoose;

// 先创建 Schema
const ArticleSchema = new Schema({
    articleId: { type: String },
    title: { type: String },
    content: { type: String },
    by: { type: String },
    modifyOn: { type: Date, default: Date.now },
}, { collection: &#x27;articles&#x27; })

// 通过 Schema 创建 Model
const Article = mongoose.model(&#x27;Article&#x27;, ArticleSchema);
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> mongoose </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;mongoose&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token maybe-class-name">Schema</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 先创建 Schema</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">ArticleSchema</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    articleId</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    title</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    content</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    by</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    modifyOn</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token property-access">now</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> collection</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;articles&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 通过 Schema 创建 Model</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Article</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Article&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token maybe-class-name">ArticleSchema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>⚠️ <strong>注意</strong>：我们不需要手动去创建 Collection，当你操作时，如 Collection 不存在，会自动创建。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 默认会操作 users 表（集合）
const User = mongoose.model(&#x27;User&#x27;, UserSchema);

// 默认会操作第三个参数配置的表 user 表（集合）
const User = mongoose.model(&#x27;User&#x27;, UserSchema, &#x27;user&#x27;)
" data-status="copy"></button><div class="token-line"><span class="token comment">// 默认会操作 users 表（集合）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">User</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;User&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token maybe-class-name">UserSchema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 默认会操作第三个参数配置的表 user 表（集合）</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">User</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;User&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token maybe-class-name">UserSchema</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;user&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>如果需要在 Schema 定义后添加其它字段，可以使用 <code>add</code> 方法。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const MySchema = new Schema;
MySchema.add({ name: &#x27;string&#x27;, color: &#x27;string&#x27;, price: &#x27;number&#x27; })
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">MySchema</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Schema</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">MySchema</span><span class="token punctuation">.</span><span class="token method function property-access">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;string&#x27;</span><span class="token punctuation">,</span><span class="token plain"> color</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;string&#x27;</span><span class="token punctuation">,</span><span class="token plain"> price</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;number&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><strong>timestamps</strong></p><p>在 Schema 中设置 timestamps 为 <code>true</code>，Schema 映射的文档 document 会自动添加 <code>createdAt</code> 和 <code>updatedAt</code> 这两个字段，代表创建时间和更新时间。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const UserSchema = new Schema(
    {...},
    { timestamps: true }
)
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">UserSchema</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"> timestamps</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p><strong>_id</strong></p><p>每个文档 document 都会被 Mongoose 添加一个唯一的 <code>_id</code>，<code>_id</code> 的数据类型不是字符串，而是 ObjectId 类型。如果在查询语句中要使用 <code>_id</code>，则需要使用 <code>findById</code> 语句，而不能使用 <code>find</code> 或 <code>findOne</code> 语句。</p><h3 id="文档保存-save"><a aria-hidden="true" href="#文档保存-save"><span class="icon icon-link"></span></a>文档保存 save</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const Tank = mongoose.model(&#x27;Tank&#x27;, schema);

// 实例化文档 document
const tank = new Tank({ size: &#x27;small&#x27; });

// 实例化后的文档必须通过 save 方法，才能将创建的文档保存到数据库的集合中，集合名称为模型名称的小写复数版
tank.save(function (err, doc) {
    if (err) return handleError(error)
})
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Tank</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Tank&#x27;</span><span class="token punctuation">,</span><span class="token plain"> schema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 实例化文档 document</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> tank </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Tank</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> size</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;small&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 实例化后的文档必须通过 save 方法，才能将创建的文档保存到数据库的集合中，集合名称为模型名称的小写复数版</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">tank</span><span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="自定义方法"><a aria-hidden="true" href="#自定义方法"><span class="icon icon-link"></span></a>自定义方法</h2><p>Model 的实例是 document，内置实例方法有很多，如 <code>save</code>，可以通过 Schema 对象的 <code>methods</code> 属性给实例自定义扩展方法。</p><h3 id="实例方法-methods"><a aria-hidden="true" href="#实例方法-methods"><span class="icon icon-link"></span></a>实例方法 methods</h3><p>这里通过添加方法查询某个字段符合指定条件的文档。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="// 定义 Schema
const animalSchema = new mongoose.Schema({
    name: String,
    type: String
})

animalSchema.methods.findSimilarTypes = function (cb) {
    return this.model(&#x27;Animal&#x27;).find({ type: this.type }, cb);
}
" data-status="copy"></button><div class="token-line"><span class="token comment">// 定义 Schema</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> animalSchema </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">mongoose</span><span class="token class-name punctuation">.</span><span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">animalSchema</span><span class="token punctuation">.</span><span class="token property-access">methods</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">findSimilarTypes</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Animal&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> cb</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>现在，所有 <code>animal</code> 实例均有 <code>findSimilarTypes</code> 方法。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const Animal = mongoose.model(&#x27;Animal&#x27;, animalSchema);

const dog = new Animal({ type: &#x27;dog&#x27; })

dog.findSimilarTypes(function(err, dogs){
  console.log(dogs); // woof
})
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Animal</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Animal&#x27;</span><span class="token punctuation">,</span><span class="token plain"> animalSchema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> dog </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;dog&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">dog</span><span class="token punctuation">.</span><span class="token method function property-access">findSimilarTypes</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> dogs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">dogs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// woof</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><ul><li>重写 Mongoose 文档的方法可以会导致不可预测的结果</li><li>上述示例使用 <code>Schema.methods</code> 对象直接赋值实例方法，你也可以使用 <code>Schema.method()</code> 描述方法</li><li>不要使用 ES6 的箭头函数，箭头函数会阻止执行上下文的绑定</li></ul><h3 id="静态方法-statics"><a aria-hidden="true" href="#静态方法-statics"><span class="icon icon-link"></span></a>静态方法 statics</h3><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="animalSchema.statics.findByName = function(name, cb) {
    return this.find({ name: new RegExp(name, &#x27;i&#x27;)}, cb);
}
// 或者
animalSchema.static(&#x27;findByBreed&#x27;, function(breed){
  return this.find({ breed })
})

const Animal = mongoose.model(&#x27;Animal&#x27;. animalSchema);

const animals = await Animal.findByName(&#x27;fido&#x27;);

ani = animals.concat(await Animal.findByBreed(&#x27;Poodle&#x27;));
" data-status="copy"></button><div class="token-line"><span class="token plain">animalSchema</span><span class="token punctuation">.</span><span class="token property-access">statics</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">findByName</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token parameter punctuation">,</span><span class="token parameter"> cb</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;i&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> cb</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 或者</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">animalSchema</span><span class="token punctuation">.</span><span class="token method function property-access">static</span><span class="token punctuation">(</span><span class="token string">&#x27;findByBreed&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">breed</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> breed </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Animal</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Animal&#x27;</span><span class="token punctuation">.</span><span class="token plain"> </span><span class="token property-access">animalSchema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> animals </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">await</span><span class="token plain"> </span><span class="token maybe-class-name">Animal</span><span class="token punctuation">.</span><span class="token method function property-access">findByName</span><span class="token punctuation">(</span><span class="token string">&#x27;fido&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">ani </span><span class="token operator">=</span><span class="token plain"> animals</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span><span class="token keyword">await</span><span class="token plain"> </span><span class="token maybe-class-name">Animal</span><span class="token punctuation">.</span><span class="token method function property-access">findByBreed</span><span class="token punctuation">(</span><span class="token string">&#x27;Poodle&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>通过上述示例可以看出，实例方法和静态方法的区别在于，静态方法是通过 Schema 对象的 <code>statics</code> 属性给个 model 添加方法，实例方法是通过 Schema 对象的 <code>methods</code> 是给 document 添加方法。</p><h3 id="查询方法"><a aria-hidden="true" href="#查询方法"><span class="icon icon-link"></span></a>查询方法</h3><p>通过 Schema 对象的 <code>query</code> 属性，给 model 添加查询方法。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="animalSchema.query.byName = function(name) {
    return this.where({ name: new RegExp(name, &#x27;i&#x27;) });
}

const Animal = mongoose.model(&#x27;Animal&#x27;, schema);

Animal.find().byName(&#x27;fido&#x27;).exec(function(err, docs){
    console.log(docs);
})

Animal.findOne().byName(&#x27;fido&#x27;).exec(function(err, doc){
    console.log(doc);
})
" data-status="copy"></button><div class="token-line"><span class="token plain">animalSchema</span><span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">byName</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">where</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token plain">name</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;i&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Animal</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Animal&#x27;</span><span class="token punctuation">,</span><span class="token plain"> schema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Animal</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">byName</span><span class="token punctuation">(</span><span class="token string">&#x27;fido&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> docs</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">docs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Animal</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">byName</span><span class="token punctuation">(</span><span class="token string">&#x27;fido&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token plain">doc</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h2 id="model-1"><a aria-hidden="true" href="#model-1"><span class="icon icon-link"></span></a>Model</h2><p>Model 是从 Schema 编译来的构造函数。 它们的实例就代表着可以从数据库保存和读取的 documents。 从数据库创建和读取 document 的所有操作都是通过 model 进行的。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const schema = new Schema({ name: String, size: String });
const Tank = mongoose.model(&#x27;Tank&#x27;, schema);
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> schema </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> name</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token punctuation">,</span><span class="token plain"> size</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">String</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Tank</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Tank&#x27;</span><span class="token punctuation">,</span><span class="token plain"> schema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>第一个参数是跟 model 对应的集合（ collection ）名字的单数形式。 Mongoose 会自动找到名称是 model 名字复数形式的 collection 。</p><p>⚠️ <strong>注意</strong>：务必将 <code>model()</code> 方法的第一个参数和其返回值设置为相同的值，否则会出现不可预知的结果。</p><h3 id="构造-documents"><a aria-hidden="true" href="#构造-documents"><span class="icon icon-link"></span></a>构造 documents</h3><p>documents 是 model 的实例。创建它们并保存到数据库非常简单：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="const Tank = mongoose.model(&#x27;Tank&#x27;, schema);

// 实例化文档 document
const tank = new Tank({ size: &#x27;small&#x27; });

// 实例化后的文档必须通过 save 方法，才能将创建的文档保存到数据库的集合中，集合名称为模型名称的小写复数版
tank.save(function(err, doc) {
  if (err) return handleError(error);
});

// or

Tank.create({ size: &#x27;small&#x27; }, function(err, doc) {
  if (err) return handleError(error);
  // saved
});
" data-status="copy"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Tank</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> mongoose</span><span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">&#x27;Tank&#x27;</span><span class="token punctuation">,</span><span class="token plain"> schema</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 实例化文档 document</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> tank </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Tank</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> size</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;small&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 实例化后的文档必须通过 save 方法，才能将创建的文档保存到数据库的集合中，集合名称为模型名称的小写复数版</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">tank</span><span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// or</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Tank</span><span class="token punctuation">.</span><span class="token method function property-access">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> size</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;small&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> doc</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// saved</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="新增"><a aria-hidden="true" href="#新增"><span class="icon icon-link"></span></a>新增</h3><p>文档新增有三种方法，一种是使用上面介绍过的文档的 <code>save()</code> 方法，另一种是使用模型 model 的 <code>create()</code> 方法，最后一种是模型 model 的 <code>insertMany()</code> 方法。</p><h3 id="查询"><a aria-hidden="true" href="#查询"><span class="icon icon-link"></span></a>查询</h3><p>支持 MongoDB 的高级（rich）查询语法。查询文档可以用 model 的 <code>find</code>、<code>findById</code>、<code>findOne</code> 和 <code>where</code> 这些静态方法。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Tank.find({ size: &#x27;small&#x27; })
  .where(&#x27;createDate&#x27;)
  .gt(oneYearAgo)
  .exec(callback);
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Tank</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> size</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;small&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">where</span><span class="token punctuation">(</span><span class="token string">&#x27;createDate&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">gt</span><span class="token punctuation">(</span><span class="token plain">oneYearAgo</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">.</span><span class="token method function property-access">exec</span><span class="token punctuation">(</span><span class="token plain">callback</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>查询 <a href="query.md">Query API</a>;</p><h3 id="删除"><a aria-hidden="true" href="#删除"><span class="icon icon-link"></span></a>删除</h3><p><code>model</code> 的 <code>remove</code> 方法可以删除所有匹配查询条件（<code>conditions</code>）的文档。</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button title="" type="button" class="__dumi-default-icon __dumi-default-btn-copy __dumi-default-code-block-copy-btn" data-clipboard-text="Tank.remove({ size: &#x27;large&#x27; }, function(err) {
  if (err) return handleError(err);
});
" data-status="copy"></button><div class="token-line"><span class="token maybe-class-name">Tank</span><span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> size</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;large&#x27;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">handleError</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="更多"><a aria-hidden="true" href="#更多"><span class="icon icon-link"></span></a>更多</h3><p>model 的 update 方法可以修改数据库中的文档，不过不会把文档返回给应用层。</p><p>如果想更新单独一条文档并且返回给应用层，可以使用 <code>findOneAndUpdate</code> 方法。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/tsejx/node-guidebook/edit/master/docs/server-application/database/mongodb/models.md">Edit this doc on GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="Last Update: ">9/4/2020, 3:39:37 PM</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="/node-guidebook/umi.js"></script>
    <script src="/node-guidebook/docs__server-application__database__mongodb__models.md.js"></script>
  </body>
</html>
