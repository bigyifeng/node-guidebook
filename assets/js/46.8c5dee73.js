(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{306:function(t,v,_){"use strict";_.r(v);var s=_(0),a=Object(s.a)({},(function(){var t=this,v=t.$createElement,_=t._self._c||v;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h1",{attrs:{id:"dns"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#dns"}},[t._v("#")]),t._v(" DNS")]),t._v(" "),_("p",[_("a",{attrs:{href:"https://tsejx.github.io/JavaScript-Guidebook/computer-networks/dns.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("关于 DNS 域名解析系统"),_("OutboundLink")],1)]),t._v(" "),_("p",[t._v("dns 模块用于解析域名。")]),t._v(" "),_("h2",{attrs:{id:"基本概况"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#基本概况"}},[t._v("#")]),t._v(" 基本概况")]),t._v(" "),_("p",[t._v("dns 模块包含两大类函数：")]),t._v(" "),_("ul",[_("li",[t._v("第一类函数，使用底层操作系统工具进行域名解析，且无需进行网络通信。 这类函数只有一个："),_("code",[t._v("dns.lookup()")])]),t._v(" "),_("li",[t._v("第二类函数，连接到真实的 DNS 服务器进行域名解析，且始终使用网络进行 DNS 查询。 这类函数包含了 dns 模块中除 "),_("code",[t._v("dns.lookup()")]),t._v(" 以外的所有函数。 这些函数使用与 "),_("code",[t._v("dns.lookup()")]),t._v(" 不同的配置文件（例如 "),_("code",[t._v("/etc/hosts")]),t._v("）")])]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("方法")]),t._v(" "),_("th",[t._v("功能")]),t._v(" "),_("th",[t._v("同步")]),t._v(" "),_("th",[t._v("网络请求")]),t._v(" "),_("th",[t._v("速度")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("lookup")]),t._v(" "),_("td",[t._v("通过系统自带的 DNS 缓存（如 "),_("code",[t._v("/etc/hosts")]),t._v("）")]),t._v(" "),_("td",[t._v("同步")]),t._v(" "),_("td",[t._v("无")]),t._v(" "),_("td",[t._v("快")])]),t._v(" "),_("tr",[_("td",[t._v("resolve")]),t._v(" "),_("td",[t._v("通过系统配置的 DNS 服务器指定的记录（rrtype 指定）")]),t._v(" "),_("td",[t._v("异步")]),t._v(" "),_("td",[t._v("有")]),t._v(" "),_("td",[t._v("慢")])])])]),t._v(" "),_("p",[_("strong",[t._v("dns 模块中 "),_("code",[t._v(".loopup")]),t._v(" 与 "),_("code",[t._v(".resolve")]),t._v(" 的区别：")])]),t._v(" "),_("p",[t._v("当你要解析一个域名的 IP 时，通过 "),_("code",[t._v(".lookup")]),t._v(" 查询直接调用 "),_("code",[t._v("getaddrinfo")]),t._v(" 来拿去地址，速度很快，但是如果本地的 "),_("code",[t._v("hosts")]),t._v(" 文件被修改了，"),_("code",[t._v(".lookup")]),t._v(" 就会拿 "),_("code",[t._v("hosts")]),t._v(" 文件中的地址，而 "),_("code",[t._v(".resolve")]),t._v(" 依旧是外部正常的地址。")]),t._v(" "),_("p",[t._v("由于 "),_("code",[t._v(".lookup")]),t._v(" 是同步的，所以如果由于什么不可控的原因导致 "),_("code",[t._v("getaddrinfo")]),t._v(" 缓慢或者阻塞是会影响整个 Node 进程的。")]),t._v(" "),_("h2",{attrs:{id:"模块方法"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#模块方法"}},[t._v("#")]),t._v(" 模块方法")]),t._v(" "),_("ul",[_("li",[_("code",[t._v("dns.lookup(hostname [,options], callback)")]),t._v("：将域名解析为第一条找到的记录")]),t._v(" "),_("li",[_("code",[t._v("dns.resolve(hostname [, rrtype], callback)")]),t._v("：将一个域名解析为一个 rrtype 指定记录类型的数组")]),t._v(" "),_("li",[_("code",[t._v("dns.reverse(ip, callback)")]),t._v("：反向解析 IP 地址，指向该 IP 地址的域名数组")]),t._v(" "),_("li",[_("code",[t._v("dns.getServer()")]),t._v("：返回一个用于当前解析的 IP 地址数组的字符串")]),t._v(" "),_("li",[_("code",[t._v("dns.setServer(servers)")]),t._v("：指定一组 IP 地址作为解析服务器")])]),t._v(" "),_("p",[t._v("🌰 "),_("strong",[t._v("示例：")])]),t._v(" "),_("div",{staticClass:"language-js extra-class"},[_("pre",{pre:!0,attrs:{class:"language-js"}},[_("code",[_("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dns "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dns'")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\ndns"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("lookup")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),_("span",{pre:!0,attrs:{class:"token string"}},[t._v("'www.google.com'")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),_("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" address")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),_("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do something")]),t._v("\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),_("h2",{attrs:{id:"记录类型"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#记录类型"}},[t._v("#")]),t._v(" 记录类型")]),t._v(" "),_("p",[t._v("域名与 IP 之间的对应关系，称为记录（record）。根据使用场景，记录可以分成不同的类型（type）。")]),t._v(" "),_("p",[t._v("常见的 DNS 记录类型：")]),t._v(" "),_("ul",[_("li",[_("strong",[t._v("A")]),t._v("：地址记录（Address），将域名指向一个 IPV4 的地址")]),t._v(" "),_("li",[_("strong",[t._v("AAAA")]),t._v("：将域名指向一个 IPV6 的地址")]),t._v(" "),_("li",[_("strong",[t._v("NS")]),t._v("：域名服务器记录（Name Server），将子域名指定其他 DNS 服务器解析。该记录只能设置为域名，不能设置为 IP 地址。")]),t._v(" "),_("li",[_("strong",[t._v("MX")]),t._v("：邮件记录（Mail eXchange），将域名指向邮件服务器地址。")]),t._v(" "),_("li",[_("strong",[t._v("CNAME")]),t._v("：规范名称记录（Canonical Name），将域名指向另一个域名，即当前查询的域名是另一个域名的跳转，详见下文。")]),t._v(" "),_("li",[_("strong",[t._v("PTR")]),t._v("：逆向查询记录（Pointer Record），只用于从 IP 地址查询域名")]),t._v(" "),_("li",[_("strong",[t._v("TXT")]),t._v("：文本长度限制 512，通常做 SPF 记录（反垃圾邮件）")]),t._v(" "),_("li",[_("strong",[t._v("CAA")]),t._v("：CA 证书颁发机构授权校验（Certification Authority Authorization）")]),t._v(" "),_("li",[_("strong",[t._v("SRV")]),t._v("：服务记录（Service Record），记录提供特定的服务的服务器")]),t._v(" "),_("li",[_("strong",[t._v("显性URL")]),t._v("：将域名 302 重定向到另一个地址")])]),t._v(" "),_("p",[t._v("一般来说，为了服务的安全可靠，至少应该有两条 NS 记录，而 A 记录和 MX 记录也可以有多条，这样就提供了服务的冗余性，防止出现单点失败。")]),t._v(" "),_("h3",{attrs:{id:"cname"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#cname"}},[t._v("#")]),t._v(" CNAME")]),t._v(" "),_("p",[_("strong",[t._v("CNAME")]),t._v(" 记录主要用于域名的内部跳转，为服务器配置提供灵活性，用户感知不到。举例来说，"),_("code",[t._v("www.baidu.com")]),t._v(" 这个域名就是一个 CNAME 记录。")]),t._v(" "),_("div",{staticClass:"language-bash extra-class"},[_("pre",{pre:!0,attrs:{class:"language-bash"}},[_("code",[t._v("$ "),_("span",{pre:!0,attrs:{class:"token function"}},[t._v("dig")]),t._v(" www.baidu.com\n\n"),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),_("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("ANSWER SECTION:\nwww.baidu.com     "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("1091")]),t._v("  IN   CNAME   www.a.shifen.com\nwww.a.shifen.com  "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("   IN     A     "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("14.215")]),t._v(".177.39\nwww.a.shifen.com  "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("   IN     A     "),_("span",{pre:!0,attrs:{class:"token number"}},[t._v("14.215")]),t._v(".177.38\n")])])]),_("p",[t._v("上面结果显示，"),_("code",[t._v("www.baidu.com")]),t._v(" 的 CNAME 记录指向 "),_("code",[t._v("www.a.shifen.com")]),t._v("。也就说，用户查询 "),_("code",[t._v("www.baidu.com")]),t._v(" 的时候，实际上返回的是 "),_("code",[t._v("www.a.shifen.com")]),t._v(" 的 IP 地址。")]),t._v(" "),_("p",[t._v("这样的好处是，变更服务器 IP 地址的时候，只要修改 "),_("code",[t._v("www.a.shifen.com")]),t._v(" 这个域名就可以了，用户的 "),_("code",[t._v("www.baidu.com")]),t._v(" 域名不用修改。")]),t._v(" "),_("p",[t._v("由于 CNAME 记录就是一个替换，所以域名一旦设置 CNAME 记录以后，就不能再设置其他记录了（比如 A 记录和 MX 记录），这是为了防止产生冲突。举例来说，"),_("code",[t._v("foo.com")]),t._v(" 指向 "),_("code",[t._v("bar.com")]),t._v("，而两个域名各有自己的 MX 记录，如果两者不一致，就会产生问题。由于顶级域名通常要设置 MX 记录，所以一般不允许用户对顶级域名设置 CNAME 记录。")]),t._v(" "),_("h3",{attrs:{id:"ptr"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#ptr"}},[t._v("#")]),t._v(" PTR")]),t._v(" "),_("p",[t._v("PTR 记录用于从 IP 地址反查域名。")]),t._v(" "),_("p",[t._v("逆向查询的一个应用，是可以防止垃圾邮件，即验证发送邮件的 IP 地址，是否真的有它所声称的域名。")]),t._v(" "),_("h2",{attrs:{id:"错误码"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#错误码"}},[t._v("#")]),t._v(" 错误码")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("错误码")]),t._v(" "),_("th",[t._v("语义")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("dns.NODATA")]),t._v(" "),_("td",[t._v("DNS 服务返回没有数据")])]),t._v(" "),_("tr",[_("td",[t._v("dns.FORMERR")]),t._v(" "),_("td",[t._v("DNS 服务器查询没有格式化")])]),t._v(" "),_("tr",[_("td",[t._v("dns.SERVFAIL")]),t._v(" "),_("td",[t._v("DNS 服务器返回失败")])]),t._v(" "),_("tr",[_("td",[t._v("dns.NOTFOUND")]),t._v(" "),_("td",[t._v("域名未找到")])]),t._v(" "),_("tr",[_("td",[t._v("dns.NOIMP")]),t._v(" "),_("td",[t._v("DNS 服务器不执行请求的操作")])]),t._v(" "),_("tr",[_("td",[t._v("dns.REFUSED")]),t._v(" "),_("td",[t._v("查询 DNS 服务器拒绝")])]),t._v(" "),_("tr",[_("td",[t._v("dns.BADQUERY")]),t._v(" "),_("td",[t._v("未格式化 DNS 查询")])]),t._v(" "),_("tr",[_("td",[t._v("dns.BADNAME")]),t._v(" "),_("td",[t._v("未格式化主机")])]),t._v(" "),_("tr",[_("td",[t._v("dns.BADFAMILY")]),t._v(" "),_("td",[t._v("没有提供地址族")])]),t._v(" "),_("tr",[_("td",[t._v("dns.BADRESP")]),t._v(" "),_("td",[t._v("未格式化 DNS 回复")])]),t._v(" "),_("tr",[_("td",[t._v("dns.CONNREFUSED")]),t._v(" "),_("td",[t._v("无法连接 DNS 服务器")])]),t._v(" "),_("tr",[_("td",[t._v("dns.TIMEOUT")]),t._v(" "),_("td",[t._v("连接 DNS 服务器超时")])]),t._v(" "),_("tr",[_("td",[t._v("dns.EOF")]),t._v(" "),_("td",[t._v("文件末尾")])]),t._v(" "),_("tr",[_("td",[t._v("dns.FILE")]),t._v(" "),_("td",[t._v("读取文件错误")])]),t._v(" "),_("tr",[_("td",[t._v("dns.NOMEM")]),t._v(" "),_("td",[t._v("内存溢出")])]),t._v(" "),_("tr",[_("td",[t._v("dns.DESTRUCTION")]),t._v(" "),_("td",[t._v("通道以及销毁")])]),t._v(" "),_("tr",[_("td",[t._v("dns.BADSTR")]),t._v(" "),_("td",[t._v("未格式化字符串")])]),t._v(" "),_("tr",[_("td",[t._v("dns.BADFLAGS")]),t._v(" "),_("td",[t._v("指定非法标记")])]),t._v(" "),_("tr",[_("td",[t._v("dns.NONAME")]),t._v(" "),_("td",[t._v("给定主机名不是数字")])]),t._v(" "),_("tr",[_("td",[t._v("dns.BADHINTS")]),t._v(" "),_("td",[t._v("指定非法的提示标志")])]),t._v(" "),_("tr",[_("td",[t._v("dns.NOTINITIALIED")]),t._v(" "),_("td",[t._v("异步 DNS 请求库初始化未完成")])]),t._v(" "),_("tr",[_("td",[t._v("dns.LOADIPHLPAPI")]),t._v(" "),_("td",[t._v("加载 iphlpapi.dll 错误")])]),t._v(" "),_("tr",[_("td",[t._v("dns.ADDRGETNETWORKPARAMS")]),t._v(" "),_("td",[t._v("找不到读取本机 DNS 信息函数")])]),t._v(" "),_("tr",[_("td",[t._v("dns.CANCELLED")]),t._v(" "),_("td",[t._v("DNS 查询取消")])])])]),t._v(" "),_("hr"),t._v(" "),_("p",[_("strong",[t._v("参考资料：")])]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"http://nodejs.cn/api/dns.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("📖 NodeJS API Documentation：DNS"),_("OutboundLink")],1)]),t._v(" "),_("li",[_("a",{attrs:{href:"https://juejin.im/post/5a4a2f00f265da431e171da4",target:"_blank",rel:"noopener noreferrer"}},[t._v("📝 从 Chrome 源码看 DNS 解析过程"),_("OutboundLink")],1)])])])}),[],!1,null,null,null);v.default=a.exports}}]);